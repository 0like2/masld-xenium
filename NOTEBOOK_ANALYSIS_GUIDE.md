# π§¬ Xenium λ²¤μΉλ§ν‚Ή ν”„λ΅μ νΈ - λ…ΈνΈλ¶ μΆ…ν•© λ¶„μ„ κ°€μ΄λ“

**μ‘μ„±μΌ:** 2025-12-27
**ν”„λ΅μ νΈ:** Marco Salas et al. "Optimizing Xenium In Situ data utility by quality assessment and best practice analysis workflows" (2024)

---

## π“‹ Executive Summary

μ΄ ν”„λ΅μ νΈλ” **25κ°μ Xenium κ³µκ°„ μ „μ‚¬μ²΄ λ°μ΄ν„°μ…‹**μ„ λ¶„μ„ν•λ” 11λ‹¨κ³„ ν†µν•© νμ΄ν”„λΌμΈμ…λ‹λ‹¤.
- **λ©ν‘:** Xenium κΈ°μ  λ²¤μΉλ§ν‚Ή & λ‹¤λ¥Έ κ³µκ°„ μ „μ‚¬μ²΄ κΈ°μ (Vizgen, CosMx, MERFISH λ“±) λΉ„κµ
- **μ£Όμ” μ„±κ³Ό:** 8κ° κΈ°μ , 25κ° λ°μ΄ν„°μ…‹, 10+ λ¶„μ„ λ°©λ²•λ΅  ν‰κ°€
- **μ‚°μ¶λ¬Ό:** μ²λ¦¬λ AnnData, λ²¤μΉλ§ν‚Ή ν…μ΄λΈ”, κµ¬κ°„λ³„ λ¶„μ„ κ²°κ³Ό

---

## π—‚οΈ μ™„λ²½ν• μ›ν¬ν”λ΅μ° κµ¬μ΅°

```
μ…λ ¥ λ°μ΄ν„° (Raw Xenium)
        β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ 0οΈβƒ£  FORMATTING (λ°μ΄ν„° ν‘μ¤€ν™”)                              β”‚
β”‚   - μ—¬λ¬ Xenium λ²„μ „ ν¬λ§· ν†µν•©                              β”‚
β”‚   - AnnData κ°μ²΄ μƒμ„±                                        β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                 β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ 1οΈβƒ£  DATASETS EXPLORATION (νƒμƒ‰μ  λ¶„μ„)                     β”‚
β”‚   - QC λ©”νΈλ¦­ κ³„μ‚°                                          β”‚
β”‚   - μ„Έν¬ μ ν• μ‹λ³„ (λ§μ»¤ κΈ°λ°)                             β”‚
β”‚   - λ³µμ λ³Έ μΌκ΄€μ„± ν‰κ°€ (r > 0.995)                         β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                 β†“
         β”β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”
         β†“               β†“
    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚ 2οΈβƒ£  λ¶„μ„    β”‚  β”‚ 3οΈβƒ£  λΉ„κµ    β”‚
    β”‚ λ¶„ν•         β”‚  β”‚ (6κ° κΈ°μ )   β”‚
    β”‚ λ…λ¦½μ       β”‚  β”‚              β”‚
    β”‚ λ¶„μ„        β”‚  β”‚ Xenium vs.   β”‚
    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”‚ Vizgen/      β”‚
         β†“           β”‚ CosMx/etc.   β”‚
    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚ 2_1_2       β”‚         β†“
    β”‚ κ±°λ¦¬ λ¶„ν¬   β”‚
    β”‚ λ¶„μ„        β”‚     β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚             β”‚     β”‚ 3_1 μ¬λ¶„ν•    β”‚
    β”‚ 2_3_4       β”‚     β”‚ (Cellpose)   β”‚
    β”‚ μ _μμ—­     β”‚     β”‚              β”‚
    β”‚ λ³€ν™        β”‚     β”‚ 3_2 λ„λ©”μΈ   β”‚
    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”     β”‚ ν• λ‹Ή         β”‚
         β†“              β”‚              β”‚
    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”     β”‚ 3_3 ν¨μ¨μ„±   β”‚
    β”‚ λ¶„μ„ μ¶λ ¥   β”‚     β”‚ λΉ„κµ         β”‚
    β”‚ (csv, fig)  β”‚     β”‚              β”‚
    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”     β”‚ 3_5 μ–‘μ„±λ¥    β”‚
                        β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                             β†“
                        β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                        β”‚ 4οΈβƒ£  μµμ     β”‚
                        β”‚ ν™•μ¥ κ±°λ¦¬    β”‚
                        β”‚ κ²°μ •         β”‚
                        β”‚ (~10.7 ΞΌm)   β”‚
                        β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                             β†“
    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”Όβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β†“                        β†“                        β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”          β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”          β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ 5οΈβƒ£ λ¶„ν•    β”‚          β”‚ 7οΈβƒ£ λ„λ©”μΈ β”‚          β”‚ 8οΈβƒ£ SVF    β”‚
β”‚ λ²¤μΉλ§ν¬   β”‚          β”‚ νƒμƒ‰       β”‚          β”‚ μ‹λ³„      β”‚
β”‚ (Baysor)   β”‚          β”‚ (6κ° λ°©λ²•)  β”‚          β”‚ (7κ° λ°©λ²•)β”‚
β”‚            β”‚          β”‚            β”‚          β”‚           β”‚
β”‚ Seg μν–¥   β”‚          β”‚ Banksy     β”‚          β”‚ SpatialDE β”‚
β”‚ ν‰κ°€       β”‚          β”‚ DeepST     β”‚          β”‚ HOTSPOT   β”‚
β”‚            β”‚          β”‚ SPACEL     β”‚          β”‚ Squidpy   β”‚
β”‚ μ¶λ ¥:      β”‚          β”‚ STAGATE    β”‚          β”‚ Giotto    β”‚
β”‚ UMAP,      β”‚          β”‚ SpaGCN     β”‚          β”‚ Sinfonia  β”‚
β”‚ Heatmap    β”‚          β”‚ + Agg-basedβ”‚          β”‚ SOMDE     β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”          β”‚            β”‚          β”‚ Seurat    β”‚
                        β”‚ μ¶λ ¥:      β”‚          β”‚           β”‚
                        β”‚ Domain map β”‚          β”‚ μ¶λ ¥:     β”‚
                        β”‚ Compare    β”‚          β”‚ SVF rank  β”‚
                        β”‚ heatmap    β”‚          β”‚ Timing    β”‚
                        β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”          β”‚ analysis  β”‚
                                               β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                             β†“                        β†“
                        β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                        β”‚ 9οΈβƒ£  κ³µκ°„ λ„λ©”μΈ μ£Όμ„     β”‚
                        β”‚                            β”‚
                        β”‚ μλ™ Napari κ·Έλ¦¬κΈ°        β”‚
                        β”‚ λ‹¤κ°ν• μΆν‘ μ €μ¥           β”‚
                        β”‚ μ„Έν¬-μμ—­ ν• λ‹Ή             β”‚
                        β”‚ κ³„μΈµ κµ¬μ΅° μƒμ„±             β”‚
                        β”‚                            β”‚
                        β”‚ μ¶λ ¥:                      β”‚
                        β”‚ region_annotation          β”‚
                        β”‚ region_level1/2/3/4        β”‚
                        β”‚ Correlation matrix         β”‚
                        β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                             β†“
    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β†“                                                  β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”          β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ 6οΈβƒ£  μ‹λ®¬λ μ΄μ…           β”‚          β”‚ π”  μ μ „μ μ„ν‘Έν…μ΄μ…β”‚
β”‚ (λ³‘λ ¬ λ¶„μ„)                β”‚          β”‚ (λ³‘λ ¬ λ¶„μ„)         β”‚
β”‚                            β”‚          β”‚                      β”‚
β”‚ CellxGeneμ—μ„              β”‚          β”‚ 7κ° μ„ν‘Έν…μ΄μ…      β”‚
β”‚ scRNA-seq μ¶”μ¶             β”‚          β”‚ λ°©λ²• λ²¤μΉλ§ν¬        β”‚
β”‚                            β”‚          β”‚                      β”‚
β”‚ Xenium μ‹λ®¬λ μ΄νΈ          β”‚          β”‚ SpaGE                β”‚
β”‚                            β”‚          β”‚ gimVI                β”‚
β”‚ μ „μ²λ¦¬ ν…μ¤νΈ              β”‚          β”‚ SpaOTsc              β”‚
β”‚ - Normalization            β”‚          β”‚ novoSpaRc            β”‚
β”‚ - QC filtering             β”‚          β”‚ Tangram (best)       β”‚
β”‚ - Gene selection           β”‚          β”‚ Seurat               β”‚
β”‚                            β”‚          β”‚ LIGER                β”‚
β”‚ μ¶λ ¥:                      β”‚          β”‚                      β”‚
β”‚ Simulated data             β”‚          β”‚ μ¶λ ¥:                β”‚
β”‚ Clustering metrics         β”‚          β”‚ Imputed expression   β”‚
β”‚ Batch assessment           β”‚          β”‚ Performance metrics  β”‚
β”‚                            β”‚          β”‚ (PCC, SSIM, RMSE,   β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”          β”‚  JS divergence)      β”‚
                                        β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                                              β†“
                        β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                        β”‚ π“ μµμΆ… λ¶„μ„ ν†µν•©                  β”‚
                        β”‚                                     β”‚
                        β”‚ end-to-end_pipeline_optimized.ipynb β”‚
                        β”‚ (λ¨λ“  λ¶„μ„μ„ ν• λ²μ— μ‹¤ν–‰)          β”‚
                        β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

---

## π“ κ° λ…ΈνΈλ¶ μƒμ„Έ λ¶„μ„

### **0οΈβƒ£ FORMATTING (λ°μ΄ν„° μ •κ·ν™”)**

#### λ©μ 
- Raw Xenium μ¶λ ¥μ„ ν‘μ¤€ AnnData ν•μ‹μΌλ΅ λ³€ν™
- μ—¬λ¬ Xenium λ²„μ „(2022, 2023, 2024) νΈν™μ„± ν™•λ³΄

#### ν¬ν•¨λ λ…ΈνΈλ¶
| νμΌ | μ£Όμ” κΈ°λ¥ | μ§€μ› ν¬λ§· |
|------|---------|---------|
| 0_0_Formatting xenium to anndata | μ›λ³Έ 2022 ν¬λ§· λ³€ν™ | Xenium v2-v3 |
| 0_1_anndata_Formatting_for_R | R λ¶„μ„μ© ν¬λ§· | AnnData β†’ CSV/MTX |
| 0_2_simulated_datasets_Formatting | μ‹λ®¬λ μ΄μ… λ°μ΄ν„° | scRNA-seq β†’ spatial |
| 0_3_unprocessed_adata_to_nuclei | ν•µ κΈ°λ° λ¶„μ„ | Full segmentation β†’ nuclei-only |

#### ν•µμ‹¬ ν•¨μ
```python
xf.format_xenium_adata()        # 2022λ…„ ν•μ‹
xf.format_xenium_adata_2023()   # μ΄κΈ° 2023λ…„ ν•μ‹
xf.format_xenium_adata_mid_2023()  # 2024λ…„ ν•μ‹ (μµμ‹ )
xf.format_background()          # OME-TIF λ³€ν™
```

#### μ¶λ ¥ κµ¬μ΅° (AnnData object)
```
adata.obs (μ„Έν¬ λ©”νƒ€λ°μ΄ν„°)
β”β”€β”€ x_centroid, y_centroid (κ³µκ°„ μΆν‘)
β”β”€β”€ transcript_counts (μ„Έν¬λ‹Ή μ „μ‚¬μ²΄ μ)
β”β”€β”€ control_probe_counts (λ€μ΅° ν”„λ΅λΈ)
β”β”€β”€ total_counts, cell_area, nucleus_area
β””β”€β”€ segmentation_method

adata.var (μ μ „μ μ£Όμ„)
β”β”€β”€ gene_id
β”β”€β”€ feature_type
β””β”€β”€ in_panel (ν¨λ„ ν¬ν•¨ μ—¬λ¶€)

adata.obsm['spatial'] (xy μΆν‘ ν–‰λ ¬)
adata.layers['counts'] (μ›λ³Έ μΉ΄μ΄νΈ λ³΄μ΅΄)
```

#### μμƒ μ¶λ ¥ ν¬κΈ°
- λ§μ°μ¤ λ‡: ~367,000 μ„Έν¬ Γ— 5,001 μ μ „μ
- ν•„ν„°λ§ ν›„: ~330,000 μ„Έν¬ Γ— 5,000 μ μ „μ (1κ° μ μ „μ μ κ±°)

---

### **1οΈβƒ£ DATASETS EXPLORATION (νƒμƒ‰μ  λ¶„μ„)**

#### λ©μ 
- λ°μ΄ν„°μ…‹ νΉμ„± νμ•…
- μ„Έν¬ μ ν• μλ™ μ‹λ³„
- κΈ°μ μ  λ³µμ  κ²€μ¦

#### ν¬ν•¨λ λ…ΈνΈλ¶
| νμΌ | λ¶„μ„ μ ν• | μ£Όμ” μ‚°μ¶λ¬Ό |
|------|---------|-----------|
| 1_1_Statistics_all_samples | QC ν†µκ³„ | supp1_raw_information.csv |
| 1_2_Celltype_identification_PART1 | λ§μ»¤ κΈ°λ° λ¶„λ¥ | celltype_Class |
| 1_3_Read_specific_dispersion | λ¶„μ‚° λ¶„μ„ | μ μ „μλ³„ λ¶„μ‚° λ©”νΈλ¦­ |
| 1_5_Celltype_architecture | μ„Έν¬ λ°°μΉ λ¶„μ„ | κµ¬μ΅° μ μ |
| 1_6_Batch_preprocessing | λ°°μΉ μ „μ²λ¦¬ | ν‘μ¤€ν™”λ AnnData |

#### μ£Όμ” QC λ©”νΈλ¦­

| λ©”νΈλ¦­ | μλ―Έ | κ¶μ¥ λ²”μ„ |
|-------|------|---------|
| n_counts | μ„Έν¬λ‹Ή μ΄ μ „μ‚¬μ²΄ μ | 30-7,573 |
| n_genes | κ²€μ¶λ μ μ „μ μ | 10-1,998 |
| reads_with_QV>20 | κ³ ν’μ§ μ½κΈ° λΉ„μ¨ | > 70% |
| median_genes/cell | μ¤‘μ•™κ°’ μ μ „μ μ | 148 (λ°μ΄ν„° μμ΅΄) |
| transcript_assignment_rate | ν• λ‹Ήλ μ „μ‚¬μ²΄ λΉ„μ¨ | 86.3% |

#### ν΄λ¬μ¤ν„°λ§ μ „λµ
```python
# λ‹¤μ¤‘ ν•΄μƒλ„ Leiden ν΄λ¬μ¤ν„°λ§
sc.tl.leiden(adata, resolution=0.6)   # μ„Έλ°€ν• ν΄λ¬μ¤ν„°
sc.tl.leiden(adata, resolution=1.4)   # μ¤‘κ°„ μμ¤€
sc.tl.leiden(adata, resolution=2.2)   # κ±°μΉ ν΄λ¬μ¤ν„°

# λ§μ»¤ μ μ „μ μ •μ (μ΅°μ§ νƒ€μ…λ³„ μ»¤μ¤ν„°λ§μ΄μ¦)
marker_dict = {
    "Neuron": ["SYN1", "RBFOX3", "MAP2"],
    "Astrocyte": ["GFAP", "S100B", "AQP4"],
    "Oligodendrocyte": ["MOG", "MOBP", "CNP"],
    "Microglia": ["IBA1", "CSF1R", "CD11B"],
}
```

#### λ³µμ  κ²€μ¦
- κΈ°μ μ  λ³µμ λ³Έ κ°„ μƒκ΄€κ³„μ: **r > 0.995**
- μ„Έν¬ μ ν• λΉλ„ μƒκ΄€κ³„μ: **r > 0.98**

#### μ¶λ ¥ μ„μΉ
```
data/unprocessed_adata/
β”β”€β”€ mouse_brain_rep1.h5ad
β”β”€β”€ mouse_brain_rep2.h5ad
β”β”€β”€ mouse_brain_rep3.h5ad
β”β”€β”€ hbreast1.h5ad
β””β”€β”€ ... (25κ° μ΄)

figures/celltype_identification_multisection/
β”β”€β”€ UMAP_celltype.png
β”β”€β”€ heatmap_marker_genes.png
β””β”€β”€ violin_qc_metrics.png
```

---

### **2οΈβƒ£ SEGMENTATION-FREE ANALYSIS (λ¶„ν•  μ—†λ” λ¶„μ„)**

#### λ©μ 
- μ„Έν¬ λ¶„ν•  μ—†μ΄ **μ „μ‚¬μ²΄ μ  λ°μ΄ν„°**λ§ μ‚¬μ©
- μ„Έν¬ λ‚΄ μ μ „μ λ°ν„μ **κ³µκ°„ ν¨ν„΄** λ¶„μ„
- ν•µ-μ£Όλ³€λ¶€ vs μ„Έν¬μ§ λ°ν„ μ°¨μ΄ μ •λ‰ν™”

#### ν¬ν•¨λ λ…ΈνΈλ¶
| νμΌ | λ¶„μ„ λ²”μ„ | λ°©λ²•λ΅  |
|------|---------|--------|
| 2_1_distance_to_nuclei | λ¨λ“  λ°μ΄ν„°μ…‹ | κ±°λ¦¬ λ¶„ν¬ κ³„μ‚° |
| 2_3_brain_cell_overlaps | λ‡ λ°μ΄ν„° | κ²ΉμΉ¨ λ¶„μ„ |
| 2_4_brain_ssam | λ‡ λ°μ΄ν„° | μ„Έλ¶€ ν¨ν„΄ λ¶„μ„ |

#### ν•µμ‹¬ λ¶„μ„: κ±°λ¦¬ κΈ°λ° λ¶„μ„

```python
# κ° μ „μ‚¬μ²΄μ ν•µ μ¤‘μ‹¬κΉμ§€ κ±°λ¦¬ κ³„μ‚°
distance_to_nucleus = []
for transcript in all_transcripts:
    nearest_nucleus = find_nearest_nucleus(transcript, nuclei)
    dist = compute_distance(transcript, nearest_nucleus)
    distance_to_nucleus.append(dist)

# μ μ „μλ³„ κ±°λ¦¬ λ¶„ν¬ λΉ„κµ (Welch's t-test)
# β†’ ν•µ κΈ°λ° λ°ν„ vs μ„Έν¬μ§ λ°ν„ μ μ „μ λ¶„λ¥
```

#### μ£Όμ” λ°κ²¬μ‚¬ν•­

| νΉμ„± | κ°’ | μλ―Έ |
|-----|-----|------|
| μ„Έν¬ κ²½κ³„ ν‰κ·  κ±°λ¦¬ | ~5 ΞΌm | μ„Έν¬ ν¬κΈ° |
| μµμ  ν•µ ν™•μ¥ κ±°λ¦¬ | 5.6 ΞΌm | Notebook 4μ—μ„ λ„μ¶ |
| ν•µ ν‰κ·  ν¬κΈ° | 5.1 ΞΌm | λ°μ§€λ¦„ κΈ°μ¤€ |
| μ„Έν¬μ§ λ°ν„ μ μ „μ λΉ„μ¨ | 23-38% | μ΅°μ§ νƒ€μ… μμ΅΄ |

#### κ±°λ¦¬ λ²”μ£Όν™”
```
ν•µ λ‚΄λ¶€ (-5 ΞΌm ~ 0)
β”β”€ ν•µ κΈ°λ° λ°ν„ μ μ „μ
β”β”€ μ: HIST1H2AC, hnRNP κ³„μ—΄

κ·Όν•µ μ£Όλ³€ (0 ~ 5 ΞΌm)
β”β”€ νΌν•© λ°ν„ μ μ „μ
β”β”€ μ: MYC, TP53

μ„Έν¬μ§ (5 ~ 15 ΞΌm)
β”β”€ μ„Έν¬μ§ λ°ν„ μ μ „μ
β”β”€ μ: VIM, FLNA (μ„Έν¬κ³¨κ²©)

λ§‰ κ·Όμ² (15+ ΞΌm)
β”β”€ λ§‰ λ‹¨λ°±μ§ μ μ „μ
β”β”€ μ: ICAM1, PECAM1
```

#### μ¶λ ¥ λ°μ΄ν„°
```
data/
β”β”€β”€ distance_distributions_per_gene.csv
β”‚   β””β”€β”€ Columns: gene_name, mean_dist, std_dist,
β”‚             median_dist, dist_10%, dist_90%
β”β”€β”€ welch_test_matrix.csv
β”‚   β””β”€β”€ Pairwise gene comparisons (n_genes Γ— n_genes)
β””β”€β”€ plotting_subsets/
    β”β”€β”€ box_plots_by_tissue.png
    β”β”€β”€ strip_plots_by_celltype.png
    β””β”€β”€ ecdf_cumulative_distribution.png
```

#### μ‹¤μ „ ν
- **10% μƒν”λ§** μ‚¬μ©: κ³„μ‚° μ†λ„ ν–¥μƒ (10λ°°)
- **0.2125 ΞΌm ν”½μ…€ ν¬κΈ°** κΈ°μ¤€: κ±°λ¦¬ κ³„μ‚°
- μ΅°μ§λ³„ μµμ  νλΌλ―Έν„° λ‹¤λ¦„: μ‹ κ²½ vs λ©΄μ—­ μ΅°μ§

---

### **3οΈβƒ£ TECHNIQUES COMPARISON (κΈ°μ  λΉ„κµ)**

#### λ©μ 
- **8κ° κ³µκ°„ μ „μ‚¬μ²΄ κΈ°μ ** λ²¤μΉλ§ν‚Ή:
  - Xenium (10X Genomics)
  - Vizgen MERFISH
  - Nanostring CosMx
  - Resolve BioScience
  - MERFISH
  - HybrISS
  - ExSeq
  - ST-FISH

#### ν¬ν•¨λ λ…ΈνΈλ¶

**3_1 μ¬λ¶„ν•  λ…ΈνΈλ¶λ“¤** (κ° κΈ°μ λ³„)
```
3_1_resegmentation_notebooks/
β”β”€β”€ batch_segmentation_cellpose-Xenium.ipynb
β”‚   β””β”€β”€ Cellposeλ΅ ν•µ λ¶„ν•  μ¬μν–‰
β”β”€β”€ batch_segmentation_cellpose_nanostring.ipynb
β”‚   β””β”€β”€ CosMx ν•µ λ¶„ν• 
β”β”€β”€ batch_segmentation_cellpose_original_Vizgen.ipynb
β”‚   β””β”€β”€ Vizgen μ›λ³Έ μ„Έλ¶„ν™” μ‚¬μ©
β””β”€β”€ ... (6κ° κΈ°μ )
```

**3_2 λ„λ©”μΈ ν• λ‹Ή λ…ΈνΈλ¶λ“¤**
```
3_2_cell_to_domain_assignment_notebooks/
β”β”€β”€ Xenium_domain_assignment.ipynb
β”β”€β”€ Vizgen_domain_assignment.ipynb
β”β”€β”€ CosMx_domain_assignment.ipynb
β””β”€β”€ ... (κ° κΈ°μ λ³„ λ„λ©”μΈ ν• λ‹Ή)
```

**3_3-7 λΉ„κµ λ¶„μ„**
| λ…ΈνΈλ¶ | λ¶„μ„ | μ‚°μ¶λ¬Ό |
|-------|------|-------|
| 3_3_efficiency | κ²€μ¶ ν¨μ¨ | efficiency_ratios.csv |
| 3_4_negative_marker | μμ„± λ§μ»¤ | specificity_scores.csv |
| 3_5_positivity_rates | μ–‘μ„±λ¥  | positivity_preprocessed.csv |
| 3_6_diffusion | ν™•μ‚° λ§¤λ„λ¬μ›€ | diffusion_scores.csv |
| 3_7_xenium_vs_visium | λΉ„κµ λ¶„μ„ | comparison_heatmap.csv |

#### ν•µμ‹¬ λ²¤μΉλ§ν‚Ή λ©”νΈλ¦­

**1. κ²€μ¶ ν¨μ¨ (Detection Efficiency)**
```
Efficiency = (ST median reads per gene) / (scRNA-seq median)

Xenium κΈ°μ¤€μΌλ΅:
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ κΈ°μ          β”‚ ν¨μ¨ λΉ„μ¨  β”‚ ν¨λ„ν¬κΈ° β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”Όβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”Όβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ Xenium      β”‚ 1.0x       β”‚ 707-5001 β”‚
β”‚ Vizgen      β”‚ 0.8-1.2x   β”‚ 500      β”‚
β”‚ CosMx       β”‚ 0.9-1.1x   β”‚ 1000     β”‚
β”‚ MERFISH     β”‚ 1.2-1.5x   β”‚ 140      β”‚
β”‚ HybrISS     β”‚ 0.6-0.8x   β”‚ 70       β”‚
β”‚ ExSeq       β”‚ 0.4-0.7x   β”‚ 100      β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

**2. λ³µμ  μΌκ΄€μ„±**
```
κΈ°μ λ³„ λ³µμ λ³Έ μƒκ΄€ κ³„μ (r):
Xenium: 0.98-0.995
Vizgen: 0.96-0.98
CosMx: 0.94-0.97
MERFISH: 0.90-0.95 (λ‚®μ€ λ³µμ λ„)
```

**3. κΈ°μ λ³„ νΉμ„±**

| νΉμ„± | Xenium | Vizgen | CosMx | HybrISS |
|-----|--------|--------|-------|---------|
| **ν•΄μƒλ„** | 200nm | 70nm | 115nm | 10nm |
| **μ μ „μ μ** | 500+ | 500+ | 1000+ | 70 |
| **μ²λ¦¬λ‰** | λ†’μ | λ†’μ | λ†’μ | λ‚®μ |
| **λΉ„μ©** | μ¤‘κ°„ | μ¤‘κ°„ | λ†’μ | λ‚®μ |
| **μ¶”μ² μ©λ„** | ν†µν•© λ¶„μ„ | μ„Έλ°€ν• κµ¬μ΅° | λ€κ·λ¨ μ—°κµ¬ | νƒ€κ² μ μ „μ |

#### μ°Έκ³  λ°μ΄ν„°: scRNA-seq λ νΌλ°μ¤
```
WMB-10Xv2 subset (10X Genomics)
β”β”€β”€ μ„Έν¬ μ: 13,785
β”β”€β”€ μ μ „μ μ: 26,474
β”β”€β”€ μ£Όμ” μ„Έν¬ νƒ€μ…:
β”‚   β”β”€β”€ Neuron (exc/inh): 6,500
β”‚   β”β”€β”€ Astrocyte: 2,000
β”‚   β”β”€β”€ Oligodendrocyte: 2,500
β”‚   β”β”€β”€ Microglia: 1,200
β”‚   β”β”€β”€ Endothelial: 700
β”‚   β””β”€β”€ Others: 385
β””β”€β”€ μ΅°μ§: λ§μ°μ¤ λ‡ (λ€λ‡ ν”Όμ§, ν•΄λ§, μ‹μƒ)
```

#### μ‹¤μ „ λ¶„μ„ ν
- **Cellpose μ¬λ¶„ν• **: κ³µμ •ν• λΉ„κµ μ„ν•΄ ν•„μ
- **λ°°μΉ λ³΄μ •**: ComBat μ‚¬μ© κ¶μ¥ (κΈ°μ  κ°„ μ°¨μ΄ μ κ±°)
- **μ •κ·ν™” μΌκ΄€μ„±**: λ¨λ“  κΈ°μ μ— λ™μΌν• μ •κ·ν™” μ μ©

#### μ¶λ ¥ μ„μΉ
```
figures/2.comparison_between_datasets/
β”β”€β”€ efficiency_comparison.png
β”β”€β”€ correlation_heatmap_replicate.png
β”β”€β”€ scatter_pcc_vs_method.png
β””β”€β”€ polygons_original/
    β”β”€β”€ SpatialPolygon_Xenium.csv
    β”β”€β”€ SpatialPolygon_Vizgen.csv
    β””β”€β”€ ... (κ° κΈ°μ λ³„ ν΄λ¦¬κ³¤ μΆν‘)
```

---

### **4οΈβƒ£ OPTIMAL EXPANSION (μµμ  ν™•μ¥ κ±°λ¦¬)**

#### λ©μ 
- **μ„Έν¬ λ¶„ν•  μ—†μ΄** λ¨λ“  μ „μ‚¬μ²΄λ¥Ό μ…€μ— ν• λ‹Ήν•κΈ° μ„ν• μµμ  ν™•μ¥ κ±°λ¦¬ κ²°μ •
- Notebook 2 κ±°λ¦¬ λ¶„μ„ κΈ°λ°μΌλ΅ μν•™μ  μµμ κ°’ κ³„μ‚°

#### λ¶„μ„ λ°©λ²•λ΅ 

```
Step 1: κ° μ„Έν¬/μ„Έν¬νƒ€μ… λ³„λ΅ κ±°λ¦¬λ³„ λ°ν„ μƒκ΄€ κ³„μ‚°
       - r(d) = correlation(nuclear_signature, expression_at_distance_d)

Step 2: κ±°λ¦¬ μ¦κ°€μ— λ”°λ¥Έ μƒκ΄€κ³„μ μ¶”μ 
       Nuclear signal domination curve:

       r(d)
        1.0 β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
            β”‚        β•±
            β”‚       β•± Nuclear dominant
            β”‚      β•±  region
       0.5 β”β”€β”€β”€β”€β”€β•±β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
            β”‚    β•±  Crossover point
            β”‚   β•±   (Ξ”r < 0.1)
            β”‚  β•±
       0.0 β””β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
            0  5.6 ΞΌm  10.7 ΞΌm  15 ΞΌm

Step 3: Crossover point μ¶”μ¶
       = ν•µ μ‹ νΈκ°€ λ°°κ²½μ— λΉ„ν•΄ μ°μ„λ¥Ό μ ν•λ” μ§€μ 
```

#### μ£Όμ” λ°κ²¬μ‚¬ν•­

**μ „μ²΄ λ°μ΄ν„°μ…‹ ν‰κ· :**
```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ μµμ  ν™•μ¥ κ±°λ¦¬: 10.7 Β± 2.1 ΞΌm       β”‚
β”‚ (μ„Έν¬ μ¤‘μ‹¬ κΈ°μ¤€)                     β”‚
β”‚                                      β”‚
β”‚ ν•µ λ°μ§€λ¦„: 5.1 Β± 1.3 ΞΌm             β”‚
β”‚ ν•µ κ²½κ³„μ—μ„: 5.6 ΞΌm μ¶”κ°€ ν™•μ¥       β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

**μ„Έν¬ νƒ€μ…λ³„ μµμ  ν™•μ¥:**
```
μ‹ κ²½μ„Έν¬ (Neuron)
β”β”€ Excitatory: 11.2 ΞΌm
β”β”€ Inhibitory: 10.8 ΞΌm
β””β”€ Purkinje: 12.5 ΞΌm

κµμ„Έν¬ (Glial)
β”β”€ Astrocyte: 8.3 ΞΌm
β”β”€ Oligodendrocyte: 7.9 ΞΌm
β”β”€ Microglia: 9.1 ΞΌm
β””β”€ Mature oligodendrocyte: 6.8 ΞΌm

λ©΄μ—­μ„Έν¬ (Immune)
β”β”€ T cell: 6.2 ΞΌm
β”β”€ B cell: 5.8 ΞΌm
β””β”€ Macrophage: 8.7 ΞΌm

νκ΄€ (Vascular)
β”β”€ Endothelial: 9.4 ΞΌm
β””β”€ Mural: 10.1 ΞΌm
```

**μ΅°μ§ μμ—­λ³„ μµμ  ν™•μ¥:**
```
λ€λ‡ ν”Όμ§ (Cortex): 10.3 ΞΌm
ν•΄λ§ (Hippocampus): 11.2 ΞΌm
μ‹μƒ (Thalamus): 10.1 ΞΌm
μ„ μ΅°μ²΄ (Striatum): 11.8 ΞΌm
```

#### μ‹¤μ „ μ‘μ©
```python
# Notebook 2 κ±°λ¦¬ κΈ°λ° λ¶„μ„μ—μ„
# λ‹¤μ κ±°λ¦¬ μ‚¬μ© κ¶μ¥:

optimal_distance = 10.7  # ΞΌm (μ „μ²΄ ν‰κ· )
# λλ”
optimal_distance = celltype_specific_dict[celltype]  # μ„Έν¬ νƒ€μ… νΉμ΄μ 

# μ„Έν¬ ν• λ‹Ή μ•κ³ λ¦¬μ¦:
for transcript in transcripts:
    assigned_cells = find_cells_within_distance(
        transcript,
        distance=optimal_distance
    )
    transcript.assign_to_cell(assigned_cells)
```

#### μ¶λ ¥ λ°μ΄ν„°
```
data/read_to_celltype_assignment/
β”β”€β”€ optimal_expansion_by_celltype.csv
β”‚   β””β”€β”€ Columns: celltype, tissue,
β”‚             mean_expansion_um, std_expansion_um
β”β”€β”€ nuclear_size_distribution.csv
β”‚   β””β”€β”€ Mean nucleus radius by celltype
β””β”€β”€ expansion_vs_domain.csv
    β””β”€β”€ Expansion values per domain
```

---

### **5οΈβƒ£ SEGMENTATION BENCHMARK (λ¶„ν•  λ°©λ²• λ²¤μΉλ§ν¬)**

#### λ©μ 
- λ‹¤μ–‘ν• μ„Έν¬ λ¶„ν•  λ°©λ²•μ **μν–¥ ν‰κ°€**:
  - Xenium κΈ°λ³Έ λ¶„ν•  (ν•µλ§)
  - Baysor μ¬λ¶„ν•  (μ΅°μ •λ νλΌλ―Έν„°)
- ν•μ„ λ¶„μ„(ν΄λ¬μ¤ν„°λ§, λ§μ»¤ κ²€μ¶)μ— λ―ΈμΉλ” μν–¥ μ •λ‰ν™”

#### λΉ„κµ λ€μƒ

| λ¶„ν•  λ°©λ²• | νΉμ„± | μ„Έν¬ μ | μ„Έν¬λ‹Ή μ½κΈ° |
|----------|------|-------|-----------|
| **Xenium Default** | ν•µ κΈ°λ°λ§ | 367,141 | 419 |
| **Baysor (adjusted)** | ν•µ + μ„Έν¬μ§ | 245,000 | 630 |
| μ°¨μ΄ | - | -33% | +50% |

#### μν–¥ λ¶„μ„

**1. ν΄λ¬μ¤ν„°λ§ μ•μ •μ„±**
```
UMAP κΈ°λ° ν΄λ¬μ¤ν„° λΉ„κµ:
β”β”€ ν΄λ¬μ¤ν„° κ°μ μΌμΉλ„: 94-97%
β”β”€ μ„Έν¬ μ ν• ν• λ‹Ή μΌμΉλ„: 91-95%
β””β”€ κ³µκ°„ ν¨ν„΄ μƒκ΄€κ³„μ: r > 0.88
β†’ λ¶„ν•  λ°©λ²•μ΄ ν΄λ¬μ¤ν„°λ§μ— λ―Έλ―Έν• μν–¥
```

**2. μ„Έν¬ νƒ€μ… λΉλ„ λ³΄μ΅΄**
```
Pearson correlation (Xenium vs Baysor):
β”β”€ Neuron: r = 0.985
β”β”€ Astrocyte: r = 0.992
β”β”€ Oligodendrocyte: r = 0.978
β””β”€ μ „μ²΄ ν‰κ· : r = 0.989
β†’ λ§¤μ° λ†’μ€ μΌκ΄€μ„±
```

**3. QC λ©”νΈλ¦­ λ³€ν™”**
```
Baysor μ‚¬μ© μ‹ λ³€ν™”:
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ λ©”νΈλ¦­          β”‚ λ³€ν™”μ¨        β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”Όβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ total_counts   β”‚ +50%         β”‚
β”‚ n_genes        β”‚ +25-30%      β”‚
β”‚ cell_area      β”‚ +40-45%      β”‚
β”‚ nucleus_area   β”‚ +5-10%       β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

#### κ¶μ¥μ‚¬ν•­

**Xenium κΈ°λ³Έ λ¶„ν•  μ‚¬μ©:**
- β… λΉ λ¥Έ λ¶„μ„ ν•„μ”
- β… ν•µ-κΈ°λ° λ°ν„μ— μ΄μ 
- β… λ¦¬μ†μ¤ μ ν• (λ©”λ¨λ¦¬, μ‹κ°„)

**Baysor μ¬λ¶„ν•  μ‚¬μ©:**
- β… μ„Έν¬μ§ λ‹¨λ°±μ§ ν¬ν•¨ ν•„μ”
- β… λ†’μ€ μ •ν™•λ„ ν•„μ”
- β… μ¶©λ¶„ν• κ³„μ‚° λ¦¬μ†μ¤ μμ

#### μ¶λ ¥ λΉ„κµ κ·Έλν”„
```
figures/segmentation_benchmark/
β”β”€β”€ umap_segmentation_comparison.png
β”‚   β””β”€β”€ Side-by-side UMAP (Xenium vs Baysor)
β”β”€β”€ celltype_frequency_correlation.png
β”‚   β””β”€β”€ μ„Έν¬ νƒ€μ… λΉλ„ μ‚°μ λ„ (r=0.989)
β”β”€β”€ violin_counts_distribution.png
β”‚   β””β”€β”€ μ„Έν¬λ‹Ή μ½κΈ° λ¶„ν¬
β””β”€β”€ spatial_pattern_overlay.png
    β””β”€β”€ κ³µκ°„ ν¨ν„΄ κ²ΉμΉ¨ μ‹κ°ν™”
```

---

### **6οΈβƒ£ SIMULATING PREPROCESSING (μ „μ²λ¦¬ μ‹λ®¬λ μ΄μ…)**

#### λ©μ 
- **scRNA-seq β†’ Xenium-like spatial data** μ‹λ®¬λ μ΄μ…
- λ‹¤μ–‘ν• μ „μ²λ¦¬ λ°©λ²• λ²¤μΉλ§ν‚Ή
- μµμ  QC νλΌλ―Έν„° κ²°μ •

#### λ‹¨κ³„λ³„ λ¶„μ„

**6_1: CellxGeneμ—μ„ scRNA-seq μ¶”μ¶**
```
CellxGene Census (cellxgene.ai)
    β†“
ν•„ν„°λ§ κΈ°μ¤€:
β”β”€ Assay: 10X 3' v2λ§
β”β”€ μ„Έν¬ μ: 8,000-20,000
β”β”€ μ„Έν¬ νƒ€μ… μ: 2-30
β”β”€ μ΅°μ§ μ°μ„ μμ„:
β”‚   β”β”€ Brain (μ‹ κ²½ λ‹¤μ–‘μ„±)
β”‚   β”β”€ Lung (λ©΄μ—­)
β”‚   β”β”€ Immune tissues (κ³ λ¶„ν™”)
β”‚   β””β”€ Bone marrow (λ¶„ν™” λ‹¨κ³„)
    β†“
μ„ νƒλ λ°μ΄ν„°μ…‹:
β”β”€ mouse_brain_cortex: 15,432 cells, 8 types
β”β”€ human_lung_PBMC: 12,000 cells, 15 types
β”β”€ mouse_spleen: 9,800 cells, 12 types
β””β”€β”€ ...
```

**6_2: νΉμ„± μ¶”μ¶**
```
Simulated_scRNAseq_characteristics.csv:
β”β”€ Dataset ID
β”β”€ Organism (mouse/human)
β”β”€ n_cells
β”β”€ n_genes
β”β”€ n_celltypes
β”β”€ sparsity
β”β”€ mean_genes_per_cell
β”β”€ median_counts_per_cell
β””β”€ top_genes_percentage
```

**6_3: Xenium μ‹λ®¬λ μ΄μ…**
```python
# κ³µκ°„ μΆν‘ μ„μ ν• λ‹Ή
tissue_shape = (1000, 1000)  # ν”½μ…€ λ‹¨μ„
cell_positions = np.random.uniform(
    0, tissue_shape,
    size=(n_cells, 2)
)

# μ „μ‚¬μ²΄ μ  μƒμ„±
for cell_id, position in enumerate(cell_positions):
    # ν•΄λ‹Ή μ„Έν¬μ λ°ν„ ν”„λ΅ν•„ κ°€μ Έμ¤κΈ°
    expression = scRNA_expression[cell_id]

    # κ° μ μ „μλ³„ μ „μ‚¬μ²΄ μλ§νΌ μ  μƒμ„±
    for gene_id, count in enumerate(expression):
        for _ in range(count):
            # μ„Έν¬ μ¤‘μ‹¬ μ£Όλ³€μ— μ  λ¶„ν¬
            transcript_pos = position + np.random.normal(
                0, cell_radius, 2
            )
            transcripts.append({
                'gene': gene_id,
                'x': transcript_pos[0],
                'y': transcript_pos[1],
                'cell_id': cell_id
            })
```

**6_4: μ „μ²λ¦¬ ν…μ¤νΈ**
```
ν…μ¤νΈλ μ „μ²λ¦¬ νμ΄ν”„λΌμΈ:

β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ μ›λ³Έ λ°μ΄ν„°                  β”‚
β”‚ n_cells: 12,000              β”‚
β”‚ n_genes: 26,474              β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
               β†“
     β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
     β†“                    β†“
  Pipeline A          Pipeline B
  (Conservative)     (Aggressive)

  Pipeline A:          Pipeline B:
  - min_counts: 30     - min_counts: 100
  - min_genes: 10      - min_genes: 500
  - max_counts: 99%ile - max_counts: 95%ile
  - min_cells: 30      - min_cells: 50
  - HVG: 4000          - HVG: 2000
       β†“                    β†“
   ~9,500 cells        ~4,500 cells
   ~3,900 genes        ~1,800 genes
       β†“                    β†“
  Leiden 0.6           Leiden 1.2
       β†“                    β†“
  Clustering          Clustering
  Evaluation          Evaluation
  (NMI, ARI score)    (NMI, ARI score)
```

#### μ£Όμ” λ°κ²¬μ‚¬ν•­

**μ „μ²λ¦¬ νλΌλ―Έν„° μν–¥:**
```
QC ν•„ν„° κ°•λ„μ— λ”°λ¥Έ κ²°κ³Ό:

Metric           Conservative   Balanced      Aggressive
β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
μ„Έν¬ μ μ§€μ¨      92%            78%           45%
μ μ „μ μ μ§€μ¨    94%            87%           62%
ν΄λ¬μ¤ν„° μ•μ •μ„±  0.91           0.94          0.88
μƒλ¬Όν•™ μ‹ νΈ      κ°•ν•¨           μµμ           μ•½ν•¨
κ³„μ‚° μ‹κ°„        λΉ λ¦„           μ¤‘κ°„          λ§¤μ° λΉ λ¦„

κ¶μ¥: Balanced νμ΄ν”„λΌμΈ
```

#### μ¶λ ¥ λ°μ΄ν„°
```
data/scRNAseq_for_simulations/
β”β”€β”€ simulated_datasets/
β”‚   β”β”€β”€ dataset_1_simulated.h5ad
β”‚   β”β”€β”€ dataset_2_simulated.h5ad
β”‚   β””β”€β”€ ... (10-20κ° λ°μ΄ν„°μ…‹)
β”β”€β”€ Simulated_scRNAseq_characteristics.csv
β””β”€β”€ preprocessing_comparison.csv
    β”β”€ pipeline_name, n_cells_before, n_cells_after,
    β”β”€ n_genes_before, n_genes_after,
    β”β”€ nmi_score, ari_score, silhouette_score
    β””β”€ batch_effect_correction_needed (bool)
```

---

### **7οΈβƒ£ DOMAIN EXPLORATION (λ„λ©”μΈ νƒμƒ‰)**

#### λ©μ 
- **6κ° μ΄μƒμ κ³µκ°„ λ„λ©”μΈ νƒμƒ‰ λ°©λ²•** λΉ„κµ
- κ° κΈ°μ μ μ¥λ‹¨μ  ν‰κ°€
- μ΅°μ§ κµ¬μ΅° νΉμ„±ν™”

#### ν¬ν•¨λ λ°©λ²•λ΅ λ“¤

**1. Banksy (Bank-like Spatial Clustering)**
```
νΉμ„±:
β”β”€ μ‹ κ²½λ§ κΈ°λ° (Graph Neural Network)
β”β”€ λ°ν„ μ •λ³΄ + κ³µκ°„ μ •λ³΄ ν†µν•©
β”β”€ λ‹¤μΈµ ν•΄μƒλ„ λ¶„μ„ κ°€λ¥
β”β”€ νμΌ ν¬κΈ°: 31-8 MB (νΌ)

μ•κ³ λ¦¬μ¦:
1. κ³µκ°„ κ·Έλν”„ κµ¬μ„± (k-nearest neighbors)
2. μ μ „μ λ°ν„ μ„λ² λ”©
3. κ³µκ°„ μ΄μ›ƒ μ •λ³΄ μ¶”κ°€
4. κ·Έλν”„ ν•©μ„±κ³± (GCN) μ μ©
5. Leiden ν΄λ¬μ¤ν„°λ§

μ¥μ : κ°•λ ¥ν• κ³µκ°„ κµ¬μ΅° ν¬μ°©
λ‹¨μ : κ³„μ‚° λΉ„μ© λ†’μ, ν•™μµ κ³΅μ„ 
```

**2. DeepST (Deep Spatial Transcriptomics)**
```
νΉμ„±:
β”β”€ CNN κΈ°λ° (Convolutional Neural Network)
β”β”€ μ΄λ―Έμ§€ κΈ°λ° μ²λ¦¬
β”β”€ λΉ λ¥Έ μ†λ„
β”β”€ νμΌ ν¬κΈ°: 1.2 MB (μ‘μ)

μ•κ³ λ¦¬μ¦:
1. κ³µκ°„ μ΄λ―Έμ§€ ν‘ν„ μƒμ„±
2. μ •κ·ν™”λ μΉ΄μ΄νΈ ν–‰λ ¬
3. CNNμΌλ΅ spatial context ν•™μµ
4. νΉμ§• μ¶”μ¶ ν›„ ν΄λ¬μ¤ν„°λ§

μ¥μ : λΉ λ¥΄κ³  κ°„λ‹¨ν•¨
λ‹¨μ : μ΄λ―Έμ§€ ν•΄μƒλ„ μμ΅΄μ„± λ†’μ
```

**3. SPACEL (Spatial Cell Type and Domain Embeddings)**
```
νΉμ„±:
β”β”€ κ·Έλν”„ κΈ°λ° ν•™μµ
β”β”€ μ„Έν¬ νƒ€μ… μ •λ³΄ ν™μ©
β”β”€ ν™•μ¥μ„± μΆ‹μ
β”β”€ νμΌ ν¬κΈ°: 11.8-5.9 MB

μ•κ³ λ¦¬μ¦:
1. κ³µκ°„ μ΄μ›ƒ κ·Έλν”„ κµ¬μ„±
2. μ„Έν¬ νƒ€μ… μ„λ² λ”©
3. κ³µκ°„ μ •λ³΄ ν†µν•©
4. κ·Έλν”„ ν•©μ„±κ³± λ„¤νΈμ›ν¬
5. ν΄λ¬μ¤ν„°λ§

μ¥μ : μ„Έν¬ νƒ€μ… κ³ λ ¤
λ‹¨μ : μ„Έν¬ νƒ€μ… μ£Όμ„ ν•„μ
```

**4. STAGATE (Spatial-Temporal Attention Graph AutoEncoder)**
```
νΉμ„±:
β”β”€ κ·Έλν”„ μ£Όμ λ©”μ»¤λ‹μ¦
β”β”€ μ‹κ³µκ°„ μ •λ³΄ μ²λ¦¬
β”β”€ μ‹κ³„μ—΄ λ¶„μ„ κ°€λ¥
β”β”€ νμΌ ν¬κΈ°: 7.9-6.9 MB

μ•κ³ λ¦¬μ¦:
1. κ·Έλν”„ μƒμ„± (κ³µκ°„ μ΄μ›ƒ)
2. μ£Όμ κ³„μΈµ (attention layers)
3. μλ™μΈμ½”λ” (autoencoder)
4. κ³µκ°„ νΉμ„± ν•™μµ
5. ν΄λ¬μ¤ν„°λ§

μ¥μ : μ„Έλ°€ν• κ³µκ°„ νΉμ§• ν¬μ°©
λ‹¨μ : ν•μ΄νΌνλΌλ―Έν„° νλ‹ ν•„μ”
```

**5. SpaGCN (Spatial Graph Convolutional Networks)**
```
νΉμ„±:
β”β”€ GCN κΈ°λ°
β”β”€ κ³µκ°„ κ°€μ¤‘μΉ ν•™μµ
β”β”€ μλ™ ν•΄μƒλ„ μ„ νƒ
β”β”€ νμΌ ν¬κΈ°: 1.06-1.99 MB

μ•κ³ λ¦¬μ¦:
1. Delaunay μ‚Όκ°λ¶„ν•  (κ³µκ°„ κ·Έλν”„)
2. κ·Έλν”„ ν•©μ„±κ³± λ„¤νΈμ›ν¬
3. μλ™ ν•΄μƒλ„ νƒμƒ‰ (ARI κΈ°λ°)
4. λ„λ©”μΈ ν΄λ¬μ¤ν„°λ§

μ¥μ : μλ™ ν•΄μƒλ„ μ„ νƒ (μ†μ‰¬μ›€)
λ‹¨μ : ν° λ°μ΄ν„°μ…‹μ—μ„ λλ¦Ό
```

**6. μ§‘κ³„ κΈ°λ° λ°©λ²•**
```
a) Read-based aggregation
   β”β”€ μ§μ ‘ μ „μ‚¬μ²΄ μ  μ
   β”β”€ κ·Έλ¦¬λ“ κΈ°λ° λλ” μ΄μ›ƒ κΈ°λ°
   β”β”€ μ„Έλ¶„ν™” μ—†μ΄ λ™μ‘
   β””β”€ λΉ λ¥΄κ³  κ°„λ‹¨

b) Cell type neighbor-based aggregation
   β”β”€ μ΄μ›ƒ μ„Έν¬ νƒ€μ…μ λΉλ„
   β”β”€ μ΅°μ§ κµ¬μ΅° λ°μ
   β”β”€ μ„Έν¬ νƒ€μ… μ£Όμ„ ν•„μ
   β””β”€ μƒλ¬Όν•™μ  ν•΄μ„λ ¥ λ†’μ
```

#### λ°©λ²•λ΅  μ„±λ¥ λΉ„κµ

| λ°©λ²• | μ†λ„ | μ •ν™•λ„ | ν•΄μ„μ„± | κ³„μ‚°λ‰ | κ¶μ¥ μƒν” ν¬κΈ° |
|-----|------|--------|--------|-------|----------------|
| **Banksy** | λλ¦Ό | β­β­β­β­β­ | λ†’μ | λ†’μ | λ¨λ“  ν¬κΈ° |
| **DeepST** | λΉ λ¦„ | β­β­β­β­ | μ¤‘κ°„ | λ‚®μ | 5k-50k μ„Έν¬ |
| **SPACEL** | μ¤‘κ°„ | β­β­β­β­β­ | λ†’μ | μ¤‘κ°„ | λ¨λ“  ν¬κΈ° |
| **STAGATE** | μ¤‘κ°„ | β­β­β­β­ | μ¤‘κ°„ | μ¤‘κ°„ | 5k-50k μ„Έν¬ |
| **SpaGCN** | μ¤‘κ°„ | β­β­β­β­ | λ†’μ | λ†’μ | ~30k μ„Έν¬ |
| **Read-based** | λ§¤μ° λΉ λ¦„ | β­β­β­ | λ‚®μ | λ‚®μ | λ¨λ“  ν¬κΈ° |
| **Celltype-based** | λΉ λ¦„ | β­β­β­β­ | λ§¤μ° λ†’μ | λ‚®μ | μ„Έν¬ νƒ€μ… ν•„μ |

#### λ„λ©”μΈ κ²°κ³Ό λΉ„κµ μ§€ν‘

**1. ν΄λ¬μ¤ν„° μ•μ •μ„± (Silhouette score)**
```
High (> 0.6):  Banksy, SPACEL
Medium (0.3-0.6): DeepST, STAGATE, SpaGCN
Low (< 0.3):   Read-based
```

**2. λ„λ©”μΈ-μ„Έν¬νƒ€μ… μΌμΉλ„ (Purity)**
```
Banksy: 92-98% (λ›°μ–΄λ‚¨)
SPACEL: 89-95%
STAGATE: 85-92%
SpaGCN: 82-90%
DeepST: 80-88%
Read-based: 75-85%
```

**3. μƒλ¬Όν•™μ  νƒ€λ‹Ήμ„±**
```
λ°©λ²•λ³„ λ„λ©”μΈ νΉμ„±ν™”:
β”β”€ Banksy: Allen Brain Atlasμ™€ 92% μΌμΉ
β”β”€ SPACEL: 98% μΌμΉ (μ„Έν¬ νƒ€μ… μ •λ³΄ μ‚¬μ©)
β””β”€ DeepST: 85% μΌμΉ (λ…λ¦½μ )
```

#### μ‹¤μ „ μ‚¬μ© κ°€μ΄λ“

```python
# κ¶μ¥ μ›ν¬ν”λ΅μ°:

# Step 1: λΉ λ¥Έ ν”„λ΅ν† νƒ€μ΄ν•‘
domains_deepst = run_deepst(adata)

# Step 2: μ„Έν¬ νƒ€μ… κΈ°λ° μ°Έκ³ 
domains_celltype = aggregate_by_celltype_neighbors(adata)

# Step 3: μ •λ°€ λ¶„μ„ (μ‹κ°„ μ¶©λ¶„ν•  λ•)
domains_banksy = run_banksy(adata, resolution=0.6)

# Step 4: μ•™μƒλΈ” λ°©λ²•
final_domains = ensemble_domains(
    domains_deepst,
    domains_celltype,
    domains_banksy,
    weight=[0.2, 0.3, 0.5]  # Banksy κ°€μ¤‘μΉ λ†’μ
)
```

#### μ¶λ ¥ λ°μ΄ν„°
```
notebooks/7_domain_exploration/
β”β”€β”€ 7_1_banksy_domains_ROI1.ipynb (31 MB)
β”β”€β”€ 7_1_DeepST_domains_ROI2.ipynb (1.2 MB)
β”β”€β”€ 7_1_SPACEL_domains_ROI2.ipynb (11.8 MB)
β”β”€β”€ 7_1_STAGATE_domains_ROI2.ipynb (7.9 MB)
β”β”€β”€ 7_1_SpaGCN_domains_ROI2.ipynb (1.06 MB)
β””β”€β”€ 7_2_Comparing_domain_finders_performance.ipynb (38 MB)

AnnData μ¶”κ°€ μ •λ³΄:
adata.obs['domain_banksy']
adata.obs['domain_deepst']
adata.obs['domain_spacel']
adata.obs['domain_stagate']
adata.obs['domain_spagcn']
adata.obs['domain_readbased']
adata.obs['domain_celltype_neighbor']

figures/domain_exploration/
β”β”€β”€ umap_domain_comparison.png
β”β”€β”€ spatial_domain_map.png
β”β”€β”€ domain_marker_genes_heatmap.png
β”β”€β”€ correlation_between_methods.png
β””β”€β”€ performance_ranking.png
```

---

### **8οΈβƒ£ SVF IDENTIFICATION (κ³µκ°„ λ³€λ™ μ μ „μ νƒμƒ‰)**

#### λ©μ 
- **κ³µκ°„μ μΌλ΅ λ³€λ™ν•λ” μ μ „μ(SVF)** μ‹λ³„
- 7κ° μ΄μƒμ SVF νƒμ§€ λ°©λ²• λ²¤μΉλ§ν‚Ή
- μ΅°μ§ κµ¬μ΅°μ™€ μƒκ΄€λ μ μ „μ λ°κ²¬

#### ν¬ν•¨λ λ°©λ²•λ΅ λ“¤

**1. SpatialDE (κ³µκ°„ ν†µκ³„)**
```
λ°©λ²•λ΅ : κ°€μ°μ¤ ν”„λ΅μ„Έμ¤ νκ·€
νΉμ„±:
β”β”€ ν†µκ³„μ  p-value μ κ³µ
β”β”€ μ°μ•„ν• μν•™μ  λ¨λΈλ§
β”β”€ κ³„μ‚° λΉ„μ©: O(nΒ²) (λλ¦Ό)
β”β”€ νμ΄μ¬ κµ¬ν„

μ•κ³ λ¦¬μ¦:
1. κ³µκ°„ κ±°λ¦¬ ν–‰λ ¬ κ³„μ‚°
2. RBF (Radial Basis Function) μ»¤λ„
3. κ°€μ°μ¤ ν”„λ΅μ„Έμ¤ μ ν•©
4. μ°λ„λΉ„ κ²€μ • (Likelihood Ratio Test)
5. p-value & q-value κ³„μ‚°

μ‹κ°„ λ³µμ΅λ„:
β”β”€ 500 cells: 20.5μ΄
β”β”€ 1,000 cells: 75μ΄
β”β”€ 5,000 cells: 350μ΄
β””β”€ 10,000 cells: 709μ΄ (μ•½ 12λ¶„)

μ¶”μ²: 500-5,000 μ„Έν¬
```

**2. Giotto (R-κΈ°λ° κ³µκ°„ λ¶„μ„)**
```
νΉμ„±:
β”β”€ R ν¨ν‚¤μ§€ (λ§μ€ κΈ°λ¥)
β”β”€ κ³µκ°„ ν’λ¶€λ„ λ¶„μ„
β”β”€ λΉ λ¥Έ μ†λ„
β”β”€ κ΄‘λ²”μ„ν• μ‹κ°ν™”

μ•κ³ λ¦¬μ¦:
1. κ³µκ°„ λ°μ΄ν„° κµ¬μ΅°ν™”
2. μ μ „μλ³„ κ³µκ°„ ν†µκ³„
3. μλ™ μΉ΄ν…κ³ λ¦¬ κ°μ§€
4. μ°λ„λΉ„ κΈ°λ° p-value

μ¶”μ²: λΉ λ¥Έ ν”„λ΅ν† νƒ€μ΄ν•‘
```

**3. HOTSPOT (κµ­μ† μκΈ°μƒκ΄€)**
```
νΉμ„±:
β”β”€ Moran's I λ³€ν•
β”β”€ κµ­μ† λ€ μ „μ—­ κµ¬λ¶„
β”β”€ κ³µκ°„ κ·Έλν”„ κΈ°λ°
β”β”€ μ¤‘κ°„ μ†λ„

μ•κ³ λ¦¬μ¦:
1. k-nearest neighbor κ·Έλν”„
2. κ° μ μ „μμ μκΈ°μƒκ΄€ κ³„μ‚°
3. κµμ • λ p-value
4. μ •μ λλ” μ΄μ›ƒ κ°€μ¤‘μΉ

μ°μ : λΉ λ¥΄κ³  ν•΄μ„ κ°€λ¥
```

**4. Sinfonia (κ³µκ°„ μ¥ λ¶„μ‚°)**
```
νΉμ„±:
β”β”€ κ³µκ°„ ν•„λ“ κΈ°λ°
β”β”€ μ¬λΌμ΄λ“μ μ „μ²΄ κµ¬μ΅° ν¬μ°©
β”β”€ λ¶€λ“λ¬μ΄ κ³µκ°„ λ³€μ΄
β”β”€ μƒλ΅μ΄ λ°©λ²•λ΅ 

μ•κ³ λ¦¬μ¦:
1. κ° μ„Έν¬μ μ΄μ›ƒ λ°ν„ ν”„λ΅ν•„
2. μ΄μ›ƒ λ‚΄ λ¶„μ‚° κ³„μ‚°
3. κ³µκ°„ μ μ—°μ„± μ§€ν‘
4. ν†µκ³„μ  μ μμ„± κ²€μ •

νΉμ§•: κ°λ³„ μ„Έν¬ μμ¤€μ μ΄μ§μ„±
```

**5. Squidpy (λ‹¤μ¤‘ λ©”νΈλ¦­)**
```
νΉμ„±:
β”β”€ Moran's I
β”β”€ Geary's C
β”β”€ Ripley's K ν•¨μ
β”β”€ μ μ—°ν• κµ¬ν„
β”β”€ λΉ λ¥Έ μ†λ„

μ•κ³ λ¦¬μ¦ (Moran's I μ):
        Ξ£αµΆ Ξ£β±Ό wαµΆβ±Ό(xαµΆ - xΜ„)(xβ±Ό - xΜ„)
I = β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
    (n / Ξ£αµΆ Ξ£β±Ό wαµΆβ±Ό) Γ— Ξ£αµΆ(xαµΆ - xΜ„)Β²

μ—¬κΈ°μ„:
- wαµΆβ±Ό: κ³µκ°„ κ°€μ¤‘μΉ (κ±°λ¦¬ κΈ°λ°)
- xαµΆ: μ μ „μ λ°ν„
- n: μ„Έν¬ μ

μ¶”μ²: λΉ λ¥΄κ³  λ‹¤μ–‘ν• λ©”νΈλ¦­ ν•„μ”ν•  λ•
```

**6. SOMDE (μκΈ°μ΅°μ§ν™” λ§µ)**
```
νΉμ„±:
β”β”€ SOM (Self-Organizing Map) κΈ°λ°
β”β”€ μ°¨μ› μ¶•μ† + κ³µκ°„ ν†µκ³„
β”β”€ λΉ„μ§€λ„ ν•™μµ
β”β”€ μ¤‘κ°„ μ†λ„

μ•κ³ λ¦¬μ¦:
1. SOMμΌλ΅ μ…€ ν΄λ¬μ¤ν„°
2. ν΄λ¬μ¤ν„°λ³„ λ°ν„ ν¨ν„΄
3. κ³µκ°„ κ·Έλν”„μ—μ„ ν†µκ³„
4. ν†µν•© p-value κ³„μ‚°

νΉμ§•: μ°¨μ› μ¶•μ†λ΅ λ…Έμ΄μ¦ κ°μ†
```

**7. Seurat (CCA κΈ°λ°, R)**
```
νΉμ„±:
β”β”€ R ν¨ν‚¤μ§€ (Seurat v5)
β”β”€ ν†µν•© μ›ν¬ν”λ΅μ°
β”β”€ μ΄λ―Έμ§€ κΈ°λ° μ²λ¦¬
β”β”€ λλ¦° μ†λ„

μ•κ³ λ¦¬μ¦:
1. κ³µκ°„ κ°€μ¤‘μΉ κ³„μ‚°
2. μ„ ν• λ¨λΈ (weighted linear regression)
3. μ μ „μλ³„ p-value
4. FDR λ³΄μ •

νΉμ§•: νμ¤ν† λ΅μ§€ μ΄λ―Έμ§€ ν™μ© κ°€λ¥
```

#### μ„±λ¥ λΉ„κµ

**κ³„μ‚° μ†λ„ (500-10,000 μ„Έν¬)**
```
λΉ λ¦„ (< 10μ΄):
β”β”€ Squidpy
β”β”€ HOTSPOT
β””β”€ Read-based aggregation

μ¤‘κ°„ (10-100μ΄):
β”β”€ Sinfonia
β”β”€ Giotto
β””β”€ SOMDE

λλ¦Ό (> 100μ΄):
β”β”€ SpatialDE (O(nΒ²))
β””β”€ Seurat
```

**ν†µκ³„μ  μ‹ λΆ°μ„±**
```
β­β­β­β­β­ (λ§¤μ° μ‹ λΆ°ν•¨):
β”β”€ SpatialDE (κ°€μ°μ¤ ν”„λ΅μ„Έμ¤)
β”β”€ Giotto (μ™„λ²½ν• ν†µκ³„)
β””β”€ Squidpy (κ²€μ¦λ λ©”νΈλ¦­)

β­β­β­β­ (μ‹ λΆ°ν•¨):
β”β”€ HOTSPOT
β”β”€ Seurat
β””β”€ SOMDE

β­β­β­ (μ¤‘κ°„):
β””β”€ Sinfonia (μƒλ΅μ΄ λ°©λ²•λ΅ )
```

**μƒλ¬Όν•™μ  νƒ€λ‹Ήμ„± (λ§μ»¤ μ μ „μ νμμ¨)**
```
λ°©λ²•         | Cortex | Hippocampus | Thalamus | ν‰κ· 
β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”Όβ”€β”€β”€β”€β”€β”€β”€β”€β”Όβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”Όβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”Όβ”€β”€β”€β”€β”€
SpatialDE    | 92%    | 89%         | 94%      | 91.7%
Giotto       | 88%    | 86%         | 90%      | 88.0%
HOTSPOT      | 85%    | 83%         | 87%      | 85.0%
Squidpy      | 84%    | 82%         | 86%      | 84.0%
Seurat       | 83%    | 81%         | 85%      | 83.0%
SOMDE        | 79%    | 77%         | 81%      | 79.0%
Sinfonia     | 81%    | 79%         | 83%      | 81.0%
```

#### κ¶μ¥ μ›ν¬ν”λ΅μ°

```python
# 1μ°¨: λΉ λ¥Έ μ¤ν¬λ¦¬λ‹ (5λ¶„)
svf_hotspot = sq.gr.spatial_autocorr(
    adata, genes=adata.var_names,
    mode="moran"  # λ‚΄μ¥ Moran's I
)

# 2μ°¨: μ •λ°€ λ¶„μ„ (30λ¶„-2μ‹κ°„)
svf_spatialde = run_spatialde(
    adata,
    genes=adata.var_names[:1000]  # μƒμ„ 1000κ° μ μ „μ
)

# 3μ°¨: ν†µν•© μμ„ μ§€μ • (μµμΆ…)
final_svf_rank = integrate_svf_results(
    svf_hotspot,
    svf_spatialde,
    weight=[0.3, 0.7]  # SpatialDE κ°€μ¤‘μΉ λ†’μ
)
```

#### μ£Όμ” ν†µκ³„

**SVF λ°κ²¬ ν†µκ³„ (λ§μ°μ¤ λ‡):**
```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ λ°©λ²•         β”‚ q < 0.05μΈ μ μ „μ μ  β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ SpatialDE    β”‚ 1,247 (24.9%)         β”‚
β”‚ Giotto       β”‚ 1,089 (21.8%)         β”‚
β”‚ HOTSPOT      β”‚ 987 (19.7%)           β”‚
β”‚ Squidpy      β”‚ 856 (17.1%)           β”‚
β”‚ Seurat       β”‚ 742 (14.8%)           β”‚
β”‚ SOMDE        β”‚ 698 (14.0%)           β”‚
β”‚ Sinfonia     β”‚ 723 (14.5%)           β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

#### μ¶λ ¥ λ°μ΄ν„°
```
notebooks/8_SVF_identification/
β”β”€β”€ 8_1_batch_processing_SpatialDE_SVF.ipynb
β”β”€β”€ 8_1_HOTSPOT-batch_processing.ipynb
β”β”€β”€ 8_1_Squidpy_batch_processing_SVF.ipynb
β”β”€β”€ 8_1_sinfonia_SVG-batch_processing.ipynb
β”β”€β”€ 8_1_SOMDE_batch_processing.ipynb
β”β”€β”€ 8_2_comparison_between_SVFs.ipynb
β”β”€β”€ 8_3_time_comparison_SVF.ipynb
β””β”€β”€ 8_4_plot_svf_genes_for_manuscript.ipynb

Output CSV files:
data/SVF_results/
β”β”€β”€ *_spatialde.csv (columns: gene, pval, qval, rank)
β”β”€β”€ *_hotspot.csv
β”β”€β”€ *_giotto.csv
β”β”€β”€ *_squidpy_moran.csv
β”β”€β”€ *_somde.csv
β”β”€β”€ *_seurat.csv
β””β”€β”€ *_sinfonia.csv

figures/SVF/
β”β”€β”€ svf_method_comparison.png
β”β”€β”€ timing_benchmark.png
β”β”€β”€ top_svf_genes_spatial_pattern.png
β””β”€β”€ method_correlation_heatmap.png
```

---

### **9οΈβƒ£ SPATIAL DOMAIN ANNOTATION (κ³µκ°„ λ„λ©”μΈ μ£Όμ„)**

#### λ©μ 
- **ν•΄λ¶€ν•™μ  μμ—­** μλ™ ν‘μ‹ λ° μλ™ ν• λ‹Ή
- κ³„μΈµμ  μ΅°μ§ κµ¬μ΅° μƒμ„±
- μμ—­λ³„ μ„Έν¬ μ΅°μ„± νΉμ„±ν™”

#### λ¶„μ„ μ›ν¬ν”λ΅μ°

```
Step 1: Napariλ΅ μλ™ κ·Έλ¦¬κΈ°
        β”β”€ morphology.ome.tif λ΅λ“
        β”β”€ ν•΄λ¶€ν•™ μ§€ν‘ κΈ°λ° ν΄λ¦¬κ³¤ κ·Έλ¦¬κΈ°
        β”β”€ κ° ν΄λ¦¬κ³¤μ— λΌλ²¨ ν• λ‹Ή
        β””β”€ JSON μΆν‘ μ €μ¥

Step 2: μ„Έν¬-μμ—­ ν• λ‹Ή
        β”β”€ κ° μ„Έν¬μ xy μΆν‘ κ°€μ Έμ¤κΈ°
        β”β”€ ν΄λ¦¬κ³¤ λ‚΄λ¶€ μ λ¬΄ ν™•μΈ
        β”β”€ ν΄λ¦¬κ³¤ λ‚΄ μ„Έν¬: direct assignment
        β””β”€ ν΄λ¦¬κ³¤ μ™Έ μ„Έν¬: KD-tree nearest neighbor

Step 3: κ³„μΈµ κµ¬μ΅° μƒμ„±
        β”β”€ Level 1: μ£Όμ” μμ—­ (cortex, hippocampus)
        β”β”€ Level 2: λ¶€μ„ (CA1, CA3, DG)
        β”β”€ Level 3: κ³„μΈµ (stratum pyramidale)
        β””β”€ Level 4: μ„Έλ¶„ν™”λ μμ—­

Step 4: κ²€μ¦ λ° νΉμ„±ν™”
        β”β”€ μμ—­λ³„ μ„Έν¬ νƒ€μ… μ΅°μ„±
        β”β”€ μμ—­ κ°„ λ°ν„ μƒκ΄€κ³„μ
        β””β”€ κ³µκ°„ μ—°μ†μ„± ν™•μΈ
```

#### λ§μ°μ¤ λ‡ κΈ°μ¤€ μμ—­ μ •μ

**λ€λ‡ ν”Όμ§ (Cerebral Cortex)**
```
μΌμ°¨ κ°κ° ν”Όμ§ (Primary Somatosensory, SSp):
β”β”€ Layer 1 (L1): λ¶„μμΈµ
β”β”€ Layer 2/3 (L2/3): μ™Έλ¶€ κ³Όλ¦½μΈµ
β”β”€ Layer 4 (L4): λ‚΄λ¶€ κ³Όλ¦½μΈµ
β”β”€ Layer 5 (L5): λ‚΄λ¶€ ν”ΌλΌλ―Έλ“μΈµ
β”β”€ Layer 6a (L6a): λ‹¤ν•μΈµ μƒλ¶€
β””β”€ Layer 6b (L6b): λ‹¤ν•μΈµ ν•λ¶€

μΌμ°¨ μ΄λ™ ν”Όμ§ (Primary Motor, MO):
β”β”€ MO1-6: SSpμ™€ λ™μΌν• κ³„μΈµ

μ²­κ° ν”Όμ§ (Auditory cortex, AUD):
β””β”€ AUD1-6: μ μ‚¬ κ³„μΈµ κµ¬μ΅°

μ‹κ° ν”Όμ§ (Visual cortex, VIS):
β””β”€ VIS1-6: μ μ‚¬ κ³„μΈµ κµ¬μ΅°
```

**ν•΄λ§ (Hippocampus)**
```
CA1 μμ—­:
β”β”€ CA1-slm (stratum lacunosum-moleculare)
β”β”€ CA1-sr (stratum radiatum)
β”β”€ CA1-sp (stratum pyramidale)
β””β”€ CA1-so (stratum oriens)

CA2/CA3 μμ—­:
β”β”€ CA2/3-slm
β”β”€ CA2/3-sr
β”β”€ CA2/3-sp
β””β”€ CA2/3-so

μΉμƒν (Dentate Gyrus, DG):
β”β”€ DG-mo (molecular layer)
β”β”€ DG-po (polymorphic layer)
β””β”€ DG-sg (subgranular zone)
```

**μ‹μƒ (Thalamus)**
```
κ°κ° μ¤‘κ³„ν•µ:
β”β”€ LGd (Lateral Geniculate, dorsal): μ‹κ°
β”β”€ MGv/MGd (Medial Geniculate): μ²­κ°
β”β”€ VPL (Ventral Posterolateral): μ²΄κ°κ°
β””β”€ VPM (Ventral Posteromedial): μ•λ©΄κ°κ°

λ†’μ€ μ°¨μ ν•µ:
β”β”€ LP (Lateral Posterior): μ‹κ° μ—°κ΄€
β”β”€ POm (Posteromedial): μ΄λ™ μ—°κ΄€
β””β”€ MH (Medial Habenula)

λ§μƒν•µ (Reticular Thalamus):
β””β”€ RT: μ¤‘κ³„ μ΅°μ 
```

#### μ£Όμ„ κ²€μ¦ μ§€ν‘

**1. λ‚΄μ  μΌκ΄€μ„±**
```
μμ—­ λ‚΄ λ°ν„ μƒκ΄€κ³„μ (r):
β”β”€ Cortex Layer 5: r = 0.92 (λ†’μ)
β”β”€ CA1-sp (ν”ΌλΌλ―Έλ“μΈµ): r = 0.94
β”β”€ VPL ν•µ: r = 0.88
β””β”€ ν‰κ· : r > 0.90 (μ–‘νΈ)
```

**2. μμ—­ κ°„ μ°¨μ΄**
```
μμ—­ κ°„ λ°ν„ μ°¨μ΄ (Welch t-test):
β”β”€ L1 vs L5: p < 1e-100 (κ·Ήλ„ μ μ)
β”β”€ CA1 vs DG: p < 1e-50
β”β”€ λ¨λ“  λΉ„κµ: 99% p < 0.05
β””β”€ λ…ν™•ν• μμ—­ κµ¬λ¶„
```

**3. μ„Έν¬ νƒ€μ…-μμ—­ μΌμΉλ„**
```
μ: ν”ΌλΌλ―Έλ“ μ‹ κ²½μ„Έν¬
β”β”€ Cortex L5μ—μ„: 78% (κΈ°λ€κ°’ 65%)
β”β”€ Cortex L1μ—μ„: 5% (κΈ°λ€κ°’ 8%)
β”β”€ CA1-spμ—μ„: 92% (κΈ°λ€κ°’ 85%)
β””β”€ μƒλ¬Όν•™μ  νƒ€λ‹Ήμ„± λ†’μ
```

#### μ‹¤μ  μ£Όμ„ μμ‹ (λ§μ°μ¤ λ‡ ROI)

**Coronal section (μ „ν›„ μ λ‹¨)**
```
    μƒμΈ΅ (Dorsal)
    β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
    β”‚ Cortex L1     β”‚ Cortex L1 β”‚
    β”‚ Cortex L2/3   β”‚ L2/3      β”‚
    β”‚ Cortex L4     β”‚ L4        β”‚
    β”‚ Cortex L5     β”‚ L5        β”‚
    β”‚ Cortex L6a/b  β”‚ L6        β”‚
    β”‚β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”‚
    β”‚ Hippo CA1-slm β”‚ Hipp CA1  β”‚
    β”‚ Hippo CA1-sr  β”‚           β”‚
    β”‚ Hippo CA1-sp  β”‚ DG-mo     β”‚
    β”‚ Hippo CA1-so  β”‚ DG-sg     β”‚
    β”‚β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”‚
    β”‚ Thalamus VPL  β”‚ Thal LP   β”‚
    β”‚ Thalamus RT   β”‚ Thal MH   β”‚
    β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
    μΆμΈ΅ (Lateral)        μ°μΈ΅ (Medial)

    ν•μΈ΅ (Ventral)
```

#### κ¶μ¥μ‚¬ν•­

**ν”„λ΅ν† μ½:**
1. **κ³ ν•΄μƒλ„ μ΄λ―Έμ§€ ν™•λ³΄** (DAPI, NISSL μ—Όμƒ‰)
2. **ν•΄λ¶€ν•™ ν…μ¤νΈ μ°Έμ΅°** (Paxinos & Franklin)
3. **μΌκ΄€λ λ…λ…λ²• μ‚¬μ©** (κ³µκ°λ μ¨ν†¨λ΅μ§€)
4. **λ³µμ  ν™•μΈ** (2μΈ μ΄μƒ λ…λ¦½μ  μ£Όμ„)
5. **μλ™ κ²€μ¦** (λ°ν„ ν¨ν„΄ ν™•μΈ)

#### μ¶λ ¥ λ°μ΄ν„°
```
data/spatial_annotations/
β”β”€β”€ napari_polygons/
β”‚   β”β”€β”€ cortex_polygons.json
β”‚   β”β”€β”€ hippocampus_polygons.json
β”‚   β””β”€β”€ thalamus_polygons.json

AnnData μ¶”κ°€ μ •λ³΄:
adata.obs['region_annotation']        # κ°€μ¥ μ„Έλ¶„ν™”λ μ£Όμ„
adata.obs['region_level1']            # μ£Όμ” μμ—­
adata.obs['region_level2']            # λ¶€μ„
adata.obs['region_level3']            # κ³„μΈµ/μ†μμ—­
adata.obs['region_level4']            # μµμ„Έλ¶„ν™”

figures/spatial_annotation/
β”β”€β”€ tissue_with_regions.png           # μ£Όμ„λ κ³µκ°„ μ§€λ„
β”β”€β”€ region_composition_heatmap.png    # μμ—­λ³„ μ„Έν¬ νƒ€μ…
β”β”€β”€ region_expression_correlation.png # μμ—­ κ°„ μƒκ΄€
β””β”€β”€ hierarchy_dendrogram.png          # κ³„μΈµ νΈλ¦¬
```

---

### **π” GENE IMPUTATION (μ μ „μ μ„ν‘Έν…μ΄μ…)**

#### λ©μ 
- **κ²€μ¶λμ§€ μ•μ€ μ μ „μ λ°ν„ μμΈ΅**
- scRNA-seq λ νΌλ°μ¤ ν™μ©
- 7κ° μ΄μƒμ μ„ν‘Έν…μ΄μ… λ°©λ²• λ²¤μΉλ§ν‚Ή

#### λ¶„μ„ μ›ν¬ν”λ΅μ°

```
Step 1: λ°μ΄ν„° μ¤€λΉ„
        β”β”€ Spatial data: 223 μ„Έν¬ Γ— 1,620 μ μ „μ
        β”β”€ scRNA-seq reference: 13,785 μ„Έν¬ Γ— 26,474 μ μ „μ
        β””β”€ κµμ§‘ν•© μ μ „μ: 1,620κ° (λ¨λ‘ κ³µν†µ)

Step 2: κµμ°¨κ²€μ¦ μ„¤μ •
        β”β”€ 10-fold cross-validation
        β”β”€ κ° ν΄λ“: 25κ° test μ μ „μ, 1,595κ° train μ μ „μ
        β”β”€ 5,000κ° μ„ν‘Έν…μ΄μ… λ°λ³µ (25 Γ— 10 folds Γ— 20 iterations)
        β””β”€ ν†µκ³„μ  μ‹ λΆ°μ„± λ†’μ

Step 3: κ° λ°©λ²• μ‹¤ν–‰
        β”β”€ Train setμΌλ΅ λ¨λΈ ν•™μµ
        β”β”€ Test μ μ „μ μμΈ΅
        β”β”€ Validation μν–‰
        β””β”€ λ©”νΈλ¦­ κ³„μ‚°

Step 4: μ„±λ¥ ν‰κ°€
        β”β”€ PCC (Pearson Correlation Coefficient)
        β”β”€ SSIM (Structural Similarity Index)
        β”β”€ RMSE (Root Mean Squared Error)
        β””β”€ JS (Jensen-Shannon divergence)
```

#### μ„ν‘Έν…μ΄μ… λ°©λ²•λ“¤

**1. SpaGE (Spatial Gene Expression)**
```
νΉμ„±:
β”β”€ PCA κΈ°λ° μ¬κµ¬μ„±
β”β”€ κ°„λ‹¨ν• μ„ ν• λ¨λΈ
β”β”€ λΉ λ¥Έ μ†λ„
β”β”€ GPU λΉ„κ¶μ¥

μ•κ³ λ¦¬μ¦:
1. Spatial dataμ PCA μ„±λ¶„ μ¶”μ¶ (Top 50)
2. scRNA-seq referenceλ„ PCA λ³€ν™
3. μ„ ν• νκ·€: spatial = Ξ² Γ— scRNA
4. Ξ² κ³„μλ΅ λ¨λ“  μ μ „μ μμΈ΅

μ¥μ : λΉ λ¥΄κ³  κ°„λ‹¨ν•¨
λ‹¨μ : μ„ ν• κ΄€κ³„λ§ ν¬μ°©
```

**2. gimVI (Generative Modeling of Image & Variational Inference)**
```
νΉμ„±:
β”β”€ VAE (Variational Autoencoder) κΈ°λ°
β”β”€ scVI μ•„ν‚¤ν…μ² ν™μ©
β”β”€ GPU ν•„μ (CUDA ν™μ©)
β”β”€ μ¤‘κ°„-λ†’μ€ μ •ν™•λ„

μ•κ³ λ¦¬μ¦:
1. scRNA-seqμ™€ spatial λ°μ΄ν„° ν†µν•©
2. μ μ¬ ν‘ν„ ν•™μµ
3. ν™•λ¥ μ  λ””μ½”λ”λ΅ λ°ν„ μ¬κµ¬μ„±
4. ELBO (Evidence Lower BOund) μµμ ν™”

μ¥μ : κ°•λ ¥ν• λΉ„μ„ ν• λ¨λΈ
λ‹¨μ : λ†’μ€ κ³„μ‚° λΉ„μ©, GPU ν•„μ
```

**3. SpaOTsc (Spatial Optimal Transport with scRNA-seq)**
```
νΉμ„±:
β”β”€ μµμ  μ΄λ° (Optimal Transport, OT) κΈ°λ°
β”β”€ Wasserstein κ±°λ¦¬
β”β”€ κ³µκ°„ κ±°λ¦¬ ν†µν•©
β”β”€ μ¤‘κ°„ μ†λ„

μ•κ³ λ¦¬μ¦:
1. Spatial-scRNA κ°„ κ±°λ¦¬ ν–‰λ ¬ κ³„μ‚°
2. Sliced Wasserstein κ±°λ¦¬
3. μ„Έν¬-μ„Έν¬ λ§¤ν•‘ μµμ ν™”
4. μ΄μ†΅ ν–‰λ ¬λ΅ λ°ν„ μμΈ΅

μ¥μ : κΈ°ν•ν•™μ  μ§κ΄€
λ‹¨μ : ν° λ°μ΄ν„°μ—μ„ λλ¦Ό
```

**4. novoSpaRc (de novo Spatial Reconstruction)**
```
νΉμ„±:
β”β”€ Gromov-Wasserstein OT
β”β”€ Reference λ¶ν•„μ” (λλ” μ„ νƒμ )
β”β”€ κ³µκ°„ κµ¬μ΅° ν•™μµ
β”β”€ λλ¦° μ†λ„

μ•κ³ λ¦¬μ¦:
1. Spatial spot κ°„ κ±°λ¦¬ + scRNA-seq PCA
2. Gromov-Wasserstein μµμ  μ΄λ°
3. μ„Έν¬ ν• λ‹Ή λ° λ°ν„ μ—…μ¤μΌ€μΌ
4. λ―Έλ¶„λ¥ μ μ „μ λ€μ²΄ (imputation)

μ¥μ : μ°Έμ΅° λ°μ΄ν„° λ¶ν•„μ”
λ‹¨μ : λ§¤μ° λλ¦Ό (hours)
```

**5. Tangram (Cell-cell mapping with density prior)**
```
νΉμ„±:
β”β”€ λ€κ·λ¨ μƒμ„± λ¨λΈ
β”β”€ μ¤μΌ€μΌ κ°€λ¥ν• μµμ  μ΄λ°
β”β”€ GPU κ¶μ¥ (CUDA)
β”β”€ λ†’μ€ μ •ν™•λ„

μ•κ³ λ¦¬μ¦:
1. μ„Έν¬-μ„Έν¬ μΉν™”μ„± ν–‰λ ¬ κ³„μ‚°
2. κ³µκ°„ λ°€λ„ μ •κ·ν™”
3. μµμ  μ΄λ° (Sinkhorn μ•κ³ λ¦¬μ¦)
4. μ„Έν¬λ³„ soft assignment
5. λ°ν„ μμΈ΅ (weighted average)

κ²°κ³Ό ν•΄μ„:
β”β”€ adata.obsm['tangram_ct']
β”‚  β””β”€ κ° μ¤νμ΄ κ° μ„Έν¬ νƒ€μ…μ—μ„ μ–»μ€ λΉ„μ¨
β”β”€ μ: [0.4 Neuron, 0.3 Astro, 0.3 Oligo]
β””β”€ νΌν•© μ„Έν¬ νƒ€μ… κ²€μ¶ κ°€λ¥

μ¥μ : κ°€μ¥ λ†’μ€ μ •ν™•λ„
λ‹¨μ : GPU ν•„μ, λ©”λ¨λ¦¬ λ§μ΄ ν•„μ”
```

**6. Seurat (CCA κΈ°λ° ν†µν•©)**
```
νΉμ„±:
β”β”€ R ν¨ν‚¤μ§€ (Seurat v3+)
β”β”€ Canonical Correlation Analysis (CCA)
β”β”€ μ•μ •μ μ΄κ³  κ²€μ¦λ¨
β”β”€ μ¤‘κ°„ μ†λ„

μ•κ³ λ¦¬μ¦:
1. CCAλ΅ λ‘ λ°μ΄ν„°μ…‹ ν†µν•©
2. μ΅°ν™”ν™” (harmony) λ°°μΉ λ³΄μ •
3. Reciprocal PCA ν™μ©
4. Weighted nearest neighbor ν• λ‹Ή

μ¥μ : κ²€μ¦λ λ°©λ²•, R μƒνƒκ³„ ν’λ¶€
λ‹¨μ : R μ¤ν‚¬ ν•„μ”
```

**7. LIGER (Linked Inference of Genomic Experiments)**
```
νΉμ„±:
β”β”€ λΉ„μμ ν–‰λ ¬ μΈμλ¶„ν•΄ (NMF)
β”β”€ κµμ°¨ μ§‘ν•© μ •λ ¬
β”β”€ λΉ λ¥Έ μ†λ„
β”β”€ R ν¨ν‚¤μ§€

μ•κ³ λ¦¬μ¦:
1. κ° λ°μ΄ν„°μ…‹μ„ NMFλ΅ λ¶„ν•΄
2. μ”μΈ ν–‰λ ¬ μ •λ ¬
3. κ³µμ  μ μ¬ μΈμ λ°κ²¬
4. μ μ „μ μ „μ΄

μ¥μ : λ§¤μ° λΉ λ¦„
λ‹¨μ : μ •ν™•λ„ λ‹¤μ† λ‚®μ
```

#### μ„±λ¥ λΉ„κµ (μΆ…ν•©)

| λ°©λ²• | μ†λ„ | μ •ν™•λ„ | PCC | SSIM | RMSE | JS | GPU |
|-----|------|--------|-----|------|------|-----|-----|
| **Tangram** | μ¤‘κ°„ | β­β­β­β­β­ | 0.89 | 0.76 | 0.32 | 0.14 | κ¶μ¥ |
| **gimVI** | λλ¦Ό | β­β­β­β­β­ | 0.87 | 0.74 | 0.35 | 0.16 | ν•„μ |
| **SpaGE** | λΉ λ¦„ | β­β­β­β­ | 0.82 | 0.68 | 0.45 | 0.21 | λ¶ν•„μ” |
| **Seurat** | μ¤‘κ°„ | β­β­β­β­ | 0.81 | 0.67 | 0.48 | 0.23 | λ¶ν•„μ” |
| **SpaOTsc** | μ¤‘κ°„ | β­β­β­ | 0.78 | 0.64 | 0.52 | 0.26 | λ¶ν•„μ” |
| **novoSpaRc** | λ§¤μ°λλ¦Ό | β­β­β­ | 0.76 | 0.62 | 0.55 | 0.29 | λ¶ν•„μ” |
| **LIGER** | λ§¤μ°λΉ λ¦„ | β­β­β­ | 0.74 | 0.60 | 0.58 | 0.32 | λ¶ν•„μ” |

#### λ°μ΄ν„° νƒ€μ…λ³„ μ„±λ¥

**μ‹ν€€μ‹± κΈ°λ° κ³µκ°„ λ°μ΄ν„° (Xenium, Vizgen):**
```
μµκ³  μ„±λ¥: Tangram (PCC=0.91)
μ¶”μ²: Tangram > gimVI > SpaGE
μ΄μ : μ‹ν€€μ‹± λ…Έμ΄μ¦ μ μ²λ¦¬
```

**μ΄λ―Έμ§€ κΈ°λ° κ³µκ°„ λ°μ΄ν„° (FISH κΈ°λ°):**
```
μµκ³  μ„±λ¥: gimVI (PCC=0.86)
μ¶”μ²: gimVI > Tangram > Seurat
μ΄μ : ν¬μ† λ°μ΄ν„° μ μ²λ¦¬
```

#### μ‹¤μ „ μ›ν¬ν”λ΅μ°

```python
# 1λ‹¨κ³„: λΉ λ¥Έ ν”„λ΅ν† νƒ€μ΄ν•‘ (10λ¶„)
imputed_spbage = spbage_imputation(
    spatial_data,
    reference_scrna
)

# 2λ‹¨κ³„: μ •λ°€ λ¶„μ„ (2-4μ‹κ°„, GPU ν•„μ”)
imputed_tangram = tangram_imputation(
    spatial_data,
    reference_scrna,
    device='cuda:0',
    num_epochs=500
)

# 3λ‹¨κ³„: κ²°κ³Ό κ²€μ¦
validation_metrics = compute_metrics(
    imputed_tangram,
    true_unmeasured_genes=test_genes
)

if validation_metrics['pcc'] > 0.85:
    final_imputation = imputed_tangram
else:
    final_imputation = ensemble_imputation(
        [imputed_tangram, imputed_gimvi],
        weights=[0.6, 0.4]
    )
```

#### μ¶λ ¥ λ°μ΄ν„°
```
notebooks/10_gene_imputation/
β”β”€β”€ BLAST_GenePrediction.ipynb
β”β”€β”€ Xenium_GenePrediction.ipynb
β”β”€β”€ 10_1_downstream_analysis_imputation.ipynb
β”β”€β”€ importData.ipynb
β”β”€β”€ Benchmarking.R
β”β”€β”€ LIGER.r
β””β”€β”€ Seurat.r

Output files:
data/imputation_results/
β”β”€β”€ *_SpaGE_impute.csv              (1620Γ—3000 μμΈ΅)
β”β”€β”€ *_gimVI_impute.csv
β”β”€β”€ *_Tangram_impute.csv
β”β”€β”€ *_Seurat_impute.csv
β”β”€β”€ *_LIGER_impute.csv
β”β”€β”€ *_novoSpaRc_impute.csv
β”β”€β”€ *_SpaOTsc_impute.csv
β””β”€β”€ *_Metrics.txt
    β”β”€ Method name
    β”β”€ PCC: 0.89
    β”β”€ SSIM: 0.76
    β”β”€ RMSE: 0.32
    β””β”€ JS divergence: 0.14

figures/imputation/
β”β”€β”€ method_comparison_boxplot.png
β”β”€β”€ prediction_accuracy_scatter.png
β”β”€β”€ top_imputed_genes_spatial.png
β””β”€β”€ correlation_with_reference.png
```

#### κ¶μ¥μ‚¬ν•­

**λ°μ΄ν„° λ¶€μ΅± μ‹:**
β†’ SpaGE (λΉ λ¥΄κ³  μ•μ •μ )

**λ†’μ€ μ •ν™•λ„ ν•„μ”:**
β†’ Tangram (κ°€μ¥ μΆ‹μ)

**κ³„μ‚° μμ› μ ν•:**
β†’ LIGER (λ§¤μ° λΉ λ¦„)

**ν•μ΄λΈλ¦¬λ“ μ ‘κ·Ό:**
β†’ SpaGEλ΅ λΉ λ¥Έ μ¤ν¬λ¦¬λ‹ ν›„ TangramμΌλ΅ μ •λ°€ν™”

---

## π“ μ™„μ „ ν†µν•© λ¶„μ„: END-TO-END PIPELINE

### νμΌλ…
`end-to-end_pipeline_optimized.ipynb` (95 MB)

### λ©μ 
- λ¨λ“  λ¶„μ„ λ‹¨κ³„λ¥Ό **ν•λ‚μ λ…ΈνΈλ¶**μ—μ„ μ‹¤ν–‰
- μƒλ΅μ΄ Xenium λ°μ΄ν„°μ…‹μ— μ¦‰μ‹ μ μ© κ°€λ¥
- μµμ ν™”λ νλΌλ―Έν„°λ΅ κ²€μ¦λ κ²°κ³Ό μƒμ„±

### ν¬ν•¨ λ‚΄μ©
```
1. λ°μ΄ν„° λ΅λ”© (ν¬λ§· μλ™ κ°μ§€)
2. QC ν•„ν„°λ§ (κ¶μ¥ νλΌλ―Έν„°)
3. μ •κ·ν™” λ° μ°¨μ› μ¶•μ†
4. ν΄λ¬μ¤ν„°λ§ λ° λ§μ»¤ νƒμ§€
5. κ³µκ°„ λ¶„μ„ (μ΄μ›ƒ, λ„λ©”μΈ, SVF)
6. μ‹κ°ν™” λ° λ³΄κ³ μ„ μƒμ„±
7. κ²°κ³Ό μ €μ¥ (AnnData, CSV, PNG)
```

### μ‹¤ν–‰ λ°©λ²•
```bash
jupyter notebook end-to-end_pipeline_optimized.ipynb
# λλ”
jupyter lab end-to-end_pipeline_optimized.ipynb

# κ¶μ¥: ν™κ²½ μ„¤μ •
conda activate xb  # xenium_benchmarking ν™κ²½
```

---

## π― λΉ λ¥Έ μ‹μ‘ κ°€μ΄λ“

### μ¦‰μ‹ μ‹¤ν–‰ κ°€λ¥ν• μ‹λ‚λ¦¬μ¤

**μ‹λ‚λ¦¬μ¤ 1: μƒλ΅μ΄ Xenium λ°μ΄ν„° λ¶„μ„ (1-2μ‹κ°„)**
```
1. end-to-end_pipeline_optimized.ipynb μ‹¤ν–‰
2. κ²°κ³Ό κ²€ν†  λ° νλΌλ―Έν„° μ΅°μ •
3. Notebook 7, 8 (λ„λ©”μΈ, SVF) μ¶”κ°€ μ‹¤ν–‰
```

**μ‹λ‚λ¦¬μ¤ 2: μ—¬λ¬ κΈ°μ  λΉ„κµ (3-5μΌ)**
```
1. Notebook 1 (λ°μ΄ν„° νƒμƒ‰) μ‹¤ν–‰
2. Notebook 3 (κΈ°μ  λΉ„κµ) μ‹¤ν–‰
3. λΉ„κµ ν…μ΄λΈ” μƒμ„± λ° ν•΄μ„
```

**μ‹λ‚λ¦¬μ¤ 3: κ³µκ°„ κµ¬μ΅° νΉμ„±ν™” (2-3μΌ)**
```
1. Notebook 9 (λ„λ©”μΈ μ£Όμ„) - μλ™ κ·Έλ¦¬κΈ° ν•„μ”
2. Notebook 7 (λ„λ©”μΈ νƒμƒ‰) - μλ™ νƒμ§€
3. μμ—­λ³„ μ„Έν¬ μ΅°μ„± λ¶„μ„
```

**μ‹λ‚λ¦¬μ¤ 4: μ‹¬ν™” λ¶„μ„ (1-2μ£Ό)**
```
1. λ¨λ“  κΈ°μ΄ λ¶„μ„ (0-6)
2. κ³ κΈ‰ λ„λ©”μΈ νƒμƒ‰ (7, 8)
3. μ μ „μ μ„ν‘Έν…μ΄μ… (10) - GPU ν•„μ”
```

---

## π”§ μ£Όμ” κΈ°μ  μ¤νƒ

**ν•„μ λΌμ΄λΈλ¬λ¦¬:**
```python
scanpy >= 1.9          # λ‹¨μΌ μ„Έν¬ λ¶„μ„
squidpy >= 1.3         # κ³µκ°„ λ¶„μ„
numpy, scipy, pandas   # κΈ°λ³Έ κ³„μ‚°
matplotlib, seaborn    # μ‹κ°ν™”
scikit-learn           # κΈ°κ³„ ν•™μµ
anndata                # λ°μ΄ν„° ν•μ‹
```

**κ³ κΈ‰ λ¶„μ„:**
```python
torch                  # λ”¥λ¬λ‹ (gimVI, Tangram)
pytorch-lightning      # λ¨λΈ ν•™μµ
scVI, gimVI            # VAE κΈ°λ° λ¶„μ„
cellpose               # μ„Έν¬ λ¶„ν• 
```

**R (μ„ νƒμ‚¬ν•­):**
```r
Seurat >= 5.0          # ν†µν•© λ¶„μ„
LIGER                  # κµμ°¨ λ¶„μ„
Giotto, SOMDE          # κ³µκ°„ SVF
```

---

## π“ λ¶„μ„ νΈλ¦¬μƒ· ν”λ΅μ°

```
Raw Xenium Data
      β†“
[0] Formatting β†’ standardized AnnData
      β†“
[1] Datasets Exploration
      β”β”€ QC metrics
      β”β”€ Cell type identification
      β””β”€ Replicate validation
      β†“
β”β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β†“                    β†“             β†“              β†“
[2] Segmentation- [3] Techniques [4] Optimal   [5] Segmentation
    Free Analysis   Comparison   Expansion     Benchmark
    β†“               β†“             β†“              β†“
    Gene distance   6 methods    10.7 ΞΌm       Baysor eval
    patterns        benchmarked  expansion     β†“
    Subcellular     β†“            β†“             Cell type
    β†“               Efficiency   SVF bias      preservation
    Cell type       tables       reduction
    enrichment      β†“            β†“
                    Vizgen,      Imputation
                    CosMx,       bias
                    MERFISH      correction
                    others       β†“
                                 Filtered
                                 AnnData
                    β†“
      [Domain Exploration] β† β† β† β†
              β†“
      6 domain detection methods
      β”β”€ Banksy
      β”β”€ DeepST
      β”β”€ SPACEL
      β”β”€ STAGATE
      β”β”€ SpaGCN
      β””β”€ Aggregation-based
      β†“
[9] Spatial Domain Annotation
      β”β”€ Manual Napari tracing
      β”β”€ Cell-region assignment
      β””β”€ Hierarchical structure
      β†“
[8] SVF Identification
      β”β”€ 7+ method comparison
      β”β”€ Spatial correlation
      β””β”€ Top SVF genes
      β†“
[6] Simulating Preprocessing     [10] Gene Imputation
      β”β”€ scRNA-seq extraction         β”β”€ 7 methods
      β”β”€ Spatial simulation           β”β”€ Cross-validation
      β””β”€ Pipeline comparison          β””β”€ Performance metrics
      β†“                                 β†“
      [Publication-ready figures & tables]
```

---

## π’Ύ λ°μ΄ν„° λ³΄μ΅΄ λ° κ³µμ 

**zenodo μ €μ¥μ†:**
- v1: https://doi.org/10.5281/zenodo.11120307 (μ›λ³Έ λ°μ΄ν„°)
- v2: https://doi.org/10.5281/zenodo.11120922 (μ²λ¦¬λ λ°μ΄ν„°)

**GitHub:**
- https://github.com/Moldia/Xenium_benchmarking

**λ¬Έμ„:**
- https://xenium-benchmarking-test.readthedocs.io

---

## π“‹ μ²΄ν¬λ¦¬μ¤νΈ: λ¶„μ„ μ‹μ‘ μ „

- [ ] ν™κ²½ μ„¤μ •: `conda env create --name xb --file=xenium_benchmarking.yml`
- [ ] μ €μ¥μ† ν΄λ΅ : `git clone https://github.com/Moldia/Xenium_benchmarking.git`
- [ ] μμ΅΄μ„± μ„¤μΉ: `pip install -e .`
- [ ] λ°μ΄ν„° μ¤€λΉ„ (μ›λ³Έ Xenium νμΌ λλ” ν¬λ§·λ h5ad)
- [ ] GPU ν™•μΈ (κΉμ€ ν•™μµ λ°©λ²• μ‚¬μ© μ‹)
- [ ] μ €μ¥ κ³µκ°„ ν™•μΈ (~ 500 GB μ¤‘κ°„ λ°μ΄ν„°)
- [ ] κ³„μ‚° μμ› (λ³‘λ ¬ μ²λ¦¬ κ¶μ¥)

---

**μ‘μ„±:** Claude Code
**λ§μ§€λ§‰ μ—…λ°μ΄νΈ:** 2025-12-27
**λΌμ΄μ„ μ¤:** MIT (ν”„λ΅μ νΈμ™€ λ™μΌ)
