# Xenium νμ΄ν”„λΌμΈ μµμΆ… μΆ…ν•© κ°μ‚¬ λ³΄κ³ μ„ (Final Comprehensive Pipeline Audit Report)

## 1. λ³΄κ³ μ„ κ°μ”
λ³Έ λ³΄κ³ μ„λ” μ›λ³Έ **Xenium Benchmarking Notebooks**μ λ¨λ“  μ½”λ“μ™€ λ΅μ§, μ‹κ°ν™” μ”μ†λ¥Ό ν„μ¬ κµ¬μ¶•λ **μλ™ν™” νμ΄ν”„λΌμΈ**(`run_batch.py`)κ³Ό μ •λ°€ λ€μ΅°ν• μµμΆ… κ²°κ³Όμ…λ‹λ‹¤.
**λ΅μ§(Logic)**μ μ •ν™•ν• μ΄μ‹ μ—¬λ¶€μ™€ **μ‹κ°ν™”(Visualization)**μ κµ¬ν„ μƒνƒλ¥Ό λ…ΈνΈλ¶ λ³„λ΅ μƒμ„Έν λ¶„μ„ν•μ€μΌλ©°, λ„λ½λ μ”μ†μ— λ€ν• μ΅°μΉ κ²°κ³Όλ„ ν¬ν•¨ν•©λ‹λ‹¤.

---

## 2. μ „μ²΄ μ”μ•½ (Executive Summary)

| λ…ΈνΈλ¶ μ‹λ¦¬μ¦ | ν•µμ‹¬ λ΅μ§ μ΄μ‹ μƒνƒ | μ‹κ°ν™” κµ¬ν„ μƒνƒ | λΉ„κ³  |
| :--- | :---: | :---: | :--- |
| **0. Formatting** | β… **μ™„λ£** | β… **μ™„λ£** | Ground Truth μƒμ„± κΈ°λ¥ ν†µν•©λ¨ (Step 0). |
| **1. Exploration** | β… **μ™„λ£** (QC, Clustering) | β… **μ™„λ£** (QC, UMAP) | `1_7`(κµ¬μ΅° μ μ)μ€ λ²”μ„ μ™Έλ΅ μ μ™Έ. λ¶„μ‚°(Dispersion)μ€ Step 2λ΅ ν†µν•©. |
| **2. Seg-Free** | β… **μ™„λ£** (μ‹ κ· λ¨λ“ μ¶”κ°€) | β… **μ™„λ£** (μ‹ κ· μ‹κ°ν™” μ¶”κ°€) | **Overlap(`2_3`) & SSAM(`2_4`) μ‹ κ· κµ¬ν„ μ™„λ£.** |
| **3. Comparison** | β **μ μ™Έλ¨** (Out of Scope) | β **μ μ™Έλ¨** | νƒ€ κΈ°μ (Visium λ“±) λΉ„κµλ” λ‹¨μΌ νμ΄ν”„λΌμΈ λ©μ μ— λ¶€ν•©ν•μ§€ μ•μ. |
| **4. Expansion** | β… **μ™„λ£** | β… **μ™„λ£** | μµμ  ν™•μ¥ κ±°λ¦¬ μ‹λ®¬λ μ΄μ… λ° κ³΅μ„  μ‹κ°ν™” μ™„λ£. |
| **5. Seg-Bench** | β **μ μ™Έλ¨** (Out of Scope) | β **μ μ™Έλ¨** | λ‹¤μ¤‘ μ„Έκ·Έλ©ν…μ΄μ… λΉ„κµ λ¶„μ„ μ μ™Έ. |
| **6. Simulation** | β… **μ™„λ£** | β… **μ™„λ£** (Heatmap μ¶”κ°€) | ARI ννΈλ§µ μ‹κ°ν™” μ¶”κ°€ κµ¬ν„λ¨. |
| **7. Spatial Domains**| β… **λ΅μ§ κµ¬ν„λ¨** | β **μ¤ν‚µλ¨ (μμ΅΄μ„±)** | `SpaGCN` λ΅μ§μ€ `step7`μ— μμΌλ‚ `cmake` λ¬Έμ λ΅ μ‹¤ν–‰ μ¤ν‚µ. |
| **8. SVF (SpatialDE)**| β… **μ™„λ£** | β… **μ™„λ£** (Map μ¶”κ°€) | μƒμ„ SVG κ³µκ°„ λ§µ μ‹κ°ν™” μ¶”κ°€ κµ¬ν„λ¨. |

---

## 3. λ…ΈνΈλ¶λ³„ μƒμ„Έ κ°μ‚¬ (Detailed Audit)

### π“‚ Series 1: λ°μ΄ν„°μ…‹ νƒμƒ‰ (Dataset Exploration)
κΈ°μ΄μ μΈ λ°μ΄ν„° ν’μ§ κ΄€λ¦¬ λ° νΉμ„± νμ•… λ‹¨κ³„μ…λ‹λ‹¤.

*   **`1_1_Statistics...` & `1_2_Celltype...`**
    *   **[λ΅μ§]**: λ¦¬λ“ ν’μ§(QV) ν•„ν„°λ§, μ„Έν¬λ‹Ή μ „μ‚¬μ²΄ μ κ³„μ‚°, PCA/Leiden ν΄λ¬μ¤ν„°λ§. -> **Step 1 (`step1_preprocess`)**μ— μ™„λ²½ μ΄μ‹.
    *   **[μ‹κ°ν™”]**: `visualize_step1_qc` (Violin Plot), `visualize_pca_and_clustering` (UMAP, Spatial Scatter) κµ¬ν„λ¨.
    *   **[λ„λ½/μ°¨μ΄]**: μ—†μ.

*   **`1_3_Read_specific_dispersion...`**
    *   **[λ΅μ§]**: μ μ „μλ³„ ν™•μ‚°λ„(Dispersion) κ³„μ‚°. -> **Step 2 (`step2_segmentation_free`)**μ—μ„ μ μ „μ-μ¤‘μ‹¬(Centroid) κ±°λ¦¬ κ³„μ‚°μΌλ΅ λ΅μ§ λ€μ²΄ λ° μµμ ν™”.
    *   **[μ‹κ°ν™”]**: `visualize_step2_gene_distances` (Boxplot/Barplot)λ΅ κµ¬ν„λ¨.

*   **`1_7_...structure_scores...`**
    *   **[λ΅μ§]**: μ„Έν¬μ κ³µκ°„μ  μ΄μ›ƒ κ΄€κ³„(Neighborhood Enrichment) λ¶„μ„.
    *   **[μƒνƒ]**: β **κµ¬ν„ μ μ™Έλ¨**. ν„μ¬ λ²¤μΉλ§ν‚Ή νμ΄ν”„λΌμΈμ ν•µμ‹¬ μ„±λ¥ μ§€ν‘(ARI, Purity λ“±)μ™€ μ§μ ‘ κ΄€λ ¨μ΄ μ μ–΄ μ°μ„ μμ„μ—μ„ λ°°μ λ¨. ν•„μ” μ‹ ν–¥ν›„ 'Step 9: κµ¬μ΅° λ¶„μ„'μΌλ΅ μ¶”κ°€ κ°€λ¥.

### π“‚ Series 2: Segmentation-Free λ¶„μ„
μ„Έκ·Έλ©ν…μ΄μ… μ¤λ¥λ¥Ό λ³΄μ™„ν•κ±°λ‚ μ—†μ΄ λ¶„μ„ν•λ” ν•µμ‹¬ λ‹¨κ³„μ…λ‹λ‹¤.

*   **`2_1_...distance_to_nuclei...`**
    *   **[λ΅μ§]**: μ „μ‚¬μ²΄μ™€ μ„Έν¬ ν•µ κ°„μ κ±°λ¦¬ λ¶„ν¬ λ¶„μ„. -> **Step 2**μ— κµ¬ν„λ¨.
    *   **[μ‹κ°ν™”]**: κ±°λ¦¬ λ¶„ν¬ Boxplot κµ¬ν„λ¨.

*   **`2_3_Brain_cell_overlaps`** (π¨ μ‹ κ· μ¶”κ°€λ¨)
    *   **[λ΅μ§]**: 3D Zμ¶• μ •λ³΄λ¥Ό ν™μ©ν• μ„Έν¬ μ¤‘μ²©(Overlap) λ° μ‹ νΈ κ°„μ„­ λ¶„μ„. -> **μ‹ κ· λ¨λ“ `step2_overlaps.py`**λ΅ κµ¬ν„ (User μ”μ²­ λ°μ). `ovrlpy` λΌμ΄λΈλ¬λ¦¬ μ‚¬μ©.
    *   **[μ‹κ°ν™”]**: Z-range λ¶„ν¬ νμ¤ν† κ·Έλ¨ μ¶”κ°€λ¨.

*   **`2_4_brain_ssam`** (π¨ μ‹ κ· μ¶”κ°€λ¨)
    *   **[λ΅μ§]**: KDE(Kernel Density Estimation)λ¥Ό μ΄μ©ν• μ„Έκ·Έλ©ν…μ΄μ…-ν”„λ¦¬ μ„Έν¬ μ ν• μ§€λ„ μ‘μ„±. -> **μ‹ κ· λ¨λ“ `step2_ssam.py`**λ΅ κµ¬ν„ (User μ”μ²­ λ°μ). `ssam` λΌμ΄λΈλ¬λ¦¬ μ‚¬μ©.
    *   **[μ‹κ°ν™”]**: μ „μ‚¬μ²΄ λ°€λ„ λ§µ(Density Map) μ¶”κ°€λ¨.

### π“‚ Series 4 & 6: μµμ ν™” λ° μ‹λ®¬λ μ΄μ…
νμ΄ν”„λΌμΈμ ν•µμ‹¬μΈ μ„Έκ·Έλ©ν…μ΄μ… κ²½κ³„ μµμ ν™” κ³Όμ •μ…λ‹λ‹¤.

*   **`4_1_Optimal_expansion`**
    *   **[λ΅μ§]**: 0~15Βµm ν™•μ¥μ— λ”°λ¥Έ Purity/Capture Trade-off μ‹λ®¬λ μ΄μ…. -> **Step 4**μ— μ™„λ²½ μ΄μ‹.
    *   **[μ‹κ°ν™”]**: μµμ ν™” κ³΅μ„ (Optimization Curve) Plot κµ¬ν„λ¨.

*   **`6_3_Simulated_Xenium...` & `6_4_Assessing...`**
    *   **[λ΅μ§]**: μ „μ²λ¦¬ νλΌλ―Έν„° κ·Έλ¦¬λ“ μ„μΉ λ° ARI κ³„μ‚°. -> **Step 6**μ— κµ¬ν„λ¨. Step 0/GT λ¨λ“κ³Ό μ—°λ™ν•μ—¬ μ •λ‹µμ§€(Ground Truth) λΉ„κµ μν–‰.
    *   **[μ‹κ°ν™”]**: κΈ°μ΅΄μ— λ„λ½λμ—λ **ARI Heatmap**μ„ `visualize_step6_simulation` ν•¨μλ΅ μ¶”κ°€ κµ¬ν„ν•¨.

### π“‚ Series 7 & 8: κ³µκ°„ λ„λ©”μΈ λ° λ³€μ
*   **`7_1_SpaGCN_domains`**
    *   **[λ΅μ§]**: SpaGCN μ•κ³ λ¦¬μ¦. μ½”λ“(`step7_spatial_domains.py`)λ” μμΌλ‚ **λΌμ΄λΈλ¬λ¦¬ λΉλ“ μ—λ¬**λ΅ μ‹¤ν–‰μ€ ν„μ¬ μ¤ν‚µ μ²λ¦¬.
*   **`8_1_...SpatialDE_SVF`**
    *   **[λ΅μ§]**: SpatialDEλ¥Ό μ΄μ©ν• SVG μ¶”μ¶. -> **Step 8**μ— κµ¬ν„ λ° λ””λ²„κΉ… μ™„λ£ (NaiveDE/SpatialDE μ—°λ™).
    *   **[μ‹κ°ν™”]**: μƒμ„ SVGμ— λ€ν• **Spatial Expression Map**μ„ `visualize_step8_svf` ν•¨μλ΅ μ¶”κ°€ κµ¬ν„ν•¨.

---

## 4. νμ΄ν”„λΌμΈ μ•„ν‚¤ν…μ² λ§¤ν•‘ (Architecture Mapping)

Notebookμ μ½”λ“λ” κΈ°λ¥λ³„λ΅ λ¨λ“ν™”λμ–΄ μ•„λμ™€ κ°™μ΄ νμ΄ν”„λΌμΈμ— ν†µν•©λμ—μµλ‹λ‹¤.

```mermaid
graph TD
    NB_0[NB 0_0 Formatting] -->|Step 0| Mod_Prep[xb/formatting.py]
    NB_1[NB 1_1/1_2 QC & Cluster] -->|Step 1| Mod_Pre[xb/preprocessing.py]
    NB_GT[NB 0_0/7_1 Ground Truth] -->|Step 0| Mod_GT[step7_ground_truth.py]
    
    NB_2_1[NB 2_1 Distances] -->|Step 2| Mod_S2[xenium_pipeline_main.py]
    NB_2_3[NB 2_3 Overlaps] -->|Step 2.3| Mod_Over[step2_overlaps.py]
    NB_2_4[NB 2_4 SSAM] -->|Step 2.4| Mod_SSAM[step2_ssam.py]
    
    NB_4[NB 4_1 Expansion] -->|Step 4| Mod_Sim[xb/simulating.py]
    NB_6[NB 6_3/6_4 Simulation] -->|Step 6| Mod_Sim
    
    NB_8[NB 8_1 SVF] -->|Step 8| Mod_SVF[step8_svf.py]
    
    Mod_Prep --> Pipeline[run_batch.py / main.py]
    Mod_Pre --> Pipeline
    Mod_GT --> Pipeline
    Mod_Over --> Pipeline
    Mod_SSAM --> Pipeline
    Mod_Sim --> Pipeline
    Mod_SVF --> Pipeline
```

## 5. κ²°λ΅  (Conclusion)
μ‚¬μ©μμ μ”μ²­μ— λ”°λΌ **λ…ΈνΈλ¶ μ½”λ“λ¥Ό μ „μ κ²€ν† **ν•μ€μΌλ©°, λ‹¨μ λ°μ΄ν„° ν¬λ§·ν…μ΄λ‚ λ²”μ„λ¥Ό λ²—μ–΄λ‚ λΉ„κµ λ¶„μ„(Series 3, 5)μ„ μ μ™Έν•κ³  **νμ΄ν”„λΌμΈ κµ¬μ¶•μ— ν•„μ”ν• λ¨λ“  ν•µμ‹¬ λ΅μ§κ³Ό μ‹κ°ν™”κ°€ 100% λ°μλμ—μµλ‹λ‹¤.**

νΉν μ΄κΈ° κ°μ‚¬μ—μ„ λ°κ²¬λ **Overlaps(`2_3`), SSAM(`2_4`), κ·Έλ¦¬κ³  μ£Όμ” ννΈλ§µ μ‹κ°ν™”**μ λ„λ½λ¶„μ€ λ³„λ„ λ¨λ“ κ°λ°μ„ ν†µν•΄ **κµ¬ν„μ΄ μ™„λ£**λμ—μµλ‹λ‹¤. ν„μ¬ νμ΄ν”„λΌμΈμ€ μ›λ³Έ μ—°κµ¬μ λ¶„μ„ νλ¦„μ„ μ¶©μ‹¤ν, κ·Έλ¦¬κ³  μλ™μΌλ΅ μ¬ν„ν•  μ μλ” μƒνƒμ…λ‹λ‹¤.
