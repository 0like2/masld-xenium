# Xenium νμ΄ν”„λΌμΈ μ‹κ°ν™” κ°€μ΄λ“ (Pipeline Visualization Guide)

λ³Έ λ¬Έμ„λ” νμ΄ν”„λΌμΈ(`run_batch.py`) μ‹¤ν–‰ κ²°κ³Όλ΅ μƒμ„±λλ” λ¨λ“  μ‹κ°ν™” μ΄λ―Έμ§€μ μΆ…λ¥, μƒμ„± μ›λ¦¬, κ·Έλ¦¬κ³  ν•΄μ„ λ°©λ²•μ„ μƒμ„Έν μ„¤λ…ν•©λ‹λ‹¤.

---

## π“‚ Step 1: λ°μ΄ν„° μ „μ²λ¦¬ λ° ν’μ§ κ΄€λ¦¬ (Preprocessing & QC)

### 1.1 QC λ°”μ΄μ¬λ¦° ν”λ΅― (`_step1_qc_violin.png`)
*   **κµ¬μ„±**: λ‘ κ°μ λ°”μ΄μ¬λ¦° ν”λ΅― (Genes per Cell, Counts per Cell).
*   **μƒμ„± μ›λ¦¬**:
    *   `scanpy.pp.calculate_qc_metrics`ν•¨μλ΅ μ„Έν¬λ³„ μ΄ κ²€μ¶ μ μ „μ μ(`n_genes_by_counts`)μ™€ μ΄ μ „μ‚¬μ²΄ μ(`total_counts`)λ¥Ό κ³„μ‚°.
    *   `seaborn.violinplot`μ„ μ‚¬μ©ν•μ—¬ κ° μ„Έν¬λ“¤μ QC μ§€ν‘ λ¶„ν¬ λ°€λ„λ¥Ό μ‹κ°ν™”.
*   **ν•΄μ„**: λ°μ΄ν„°μ ν’μ§ λ¶„ν¬ ν™•μΈ. λ„λ¬΄ λ‚®κ±°λ‚(Dead cell) λ†’μ€(Doublet) μ„Έν¬λ¥Ό μ‹λ³„.

### 1.2 PCA λ¶„μ‚° λΉ„μ¨ (`_step1_pca_variance.png`)
*   **κµ¬μ„±**: μ£Όμ„±λ¶„(PC) κ°μμ— λ”°λ¥Έ λ¶„μ‚° μ„¤λ…λ ¥(Variance Ratio) κΊΎμ€μ„  κ·Έλν”„.
*   **μƒμ„± μ›λ¦¬**:
    *   `scanpy.pp.pca`λ΅ μ°¨μ› μ¶•μ† μν–‰.
    *   κ° PCκ°€ μ „μ²΄ λ°μ΄ν„° λ³€λ™μ„±μ λ‡ %λ¥Ό μ„¤λ…ν•λ”μ§€ κ³„μ‚°ν•μ—¬ ν”λ΅ν….
*   **ν•΄μ„**: 'Elbow Point'λ¥Ό μ°Ύμ•„ μ΄ν›„ λ¶„μ„(UMAP, Clustering)μ— μ‚¬μ©ν•  μ μ ν• PC κ°μλ¥Ό κ²°μ •.

### 1.3 UMAP ν¬μλ„ (`_step1_umap_plot.png`)
*   **κµ¬μ„±**: 2μ°¨μ› ν‰λ©΄μ— ν¬μλ μ„Έν¬ μ (Point)λ“¤. μƒ‰μƒμ€ ν΄λ¬μ¤ν„°(Leiden)λ¥Ό λ‚νƒ€λƒ„.
*   **μƒμ„± μ›λ¦¬**:
    *   **μ…λ ¥**: μƒμ„ PCλ“¤μ„ μ΄μ©ν•΄ κ³„μ‚°λ μ΄μ›ƒ κ·Έλν”„(Computed Neighborhood Graph).
    *   **μ•κ³ λ¦¬μ¦**: UMAP(Uniform Manifold Approximation and Projection) μ•κ³ λ¦¬μ¦μΌλ΅ κ³ μ°¨μ› λ°μ΄ν„°λ¥Ό 2μ°¨μ›μΌλ΅ λΉ„μ„ ν• μ¶•μ†. μ΄μ›ƒ κ°„μ κ±°λ¦¬λ¥Ό λ³΄μ΅΄ν•λ ¤ λ…Έλ ¥ν•¨.
    *   **μ‹κ°ν™”**: `scanpy.pl.umap` μ‚¬μ©.
*   **ν•΄μ„**: μ„Έν¬ κ°„μ μ μ‚¬μ„± ν™•μΈ. κ°€κΉμ΄ λ¨μ—¬ μλ” μ λ“¤μ€ μ μ „μ λ°ν„ ν¨ν„΄μ΄ μ μ‚¬ν• μ„Έν¬λ“¤μ„.

### 1.4 κ³µκ°„ ν΄λ¬μ¤ν„° λ§µ (`_spatial_clusters.png`)
*   **κµ¬μ„±**: μ‹¤μ  μ΅°μ§ μΆν‘(X, Y) μ„μ— κ·Έλ ¤μ§„ μ„Έν¬ μ λ“¤. μƒ‰μƒμ€ UMAPκ³Ό λ™μΌν• ν΄λ¬μ¤ν„°.
*   **μƒμ„± μ›λ¦¬**:
    *   `adata.obs['x_centroid']`, `['y_centroid']` μΆν‘λ¥Ό X, Yμ¶•μΌλ΅ λ§¤ν•‘.
    *   `scanpy.pl.spatial` ν•¨μλ¥Ό μ‚¬μ©ν•μ—¬ μ‹¤μ  μ΅°μ§ ν•νƒ κ·Έλ€λ΅ μ¶λ ¥.
*   **ν•΄μ„**: νΉμ • μ„Έν¬ μ ν•(ν΄λ¬μ¤ν„°)μ΄ μ΅°μ§μ μ–΄λ λ¶€μ„μ— μ„μΉν•λ”μ§€(κ³µκ°„μ  λ¶„ν¬) ν™•μΈ.

---

## π“‚ Step 2: Segmentation-Free λ¶„μ„

### 2.1 μ μ „μ-ν•µ κ±°λ¦¬ λ¶„ν¬ (`_step2_gene_dist_boxplot.png`)
*   **κµ¬μ„±**: μ μ „μλ³„ λ°•μ¤ν”λ΅― (Xμ¶•: μ μ „μ, Yμ¶•: ν•µ μ¤‘μ‹¬κΉμ§€μ κ±°λ¦¬).
*   **μƒμ„± μ›λ¦¬**:
    *   λ¨λ“  μ „μ‚¬μ²΄(Read)μ™€ ν•΄λ‹Ή μ„Έν¬ ν•µ μ¤‘μ‹¬ κ°„μ μ ν΄λ¦¬λ“ κ±°λ¦¬ κ³„μ‚°.
    *   ν‰κ·  κ±°λ¦¬κ°€ κ°€μ¥ λ¨Ό μƒμ„ 20κ° μ μ „μλ¥Ό μ¶”μ¶ν•μ—¬ `seaborn.boxplot`μΌλ΅ λ¶„ν¬ μ‹κ°ν™”.
*   **ν•΄μ„**: ν•µμ—μ„ λ©€λ¦¬ λ–¨μ–΄μ§„(μ„Έν¬μ§ λλ” μ„Έν¬ λ°–) μ μ „μλ¥Ό μ‹λ³„ν•μ—¬ ν™•μ‚°(Dispersion)μ΄ ν° μ μ „μ νμ•….

### 2.2 μ„Έν¬ μ¤‘μ²© λ¶„ν¬ (`step2_overlaps/z_range_distribution.png`)
*   **κµ¬μ„±**: νμ¤ν† κ·Έλ¨ (Xμ¶•: Zμ¶• λ²”μ„, Yμ¶•: μ„Έν¬ λΉλ„).
*   **μƒμ„± μ›λ¦¬**:
    *   κ° μ„Έν¬μ— ν• λ‹Ήλ μ „μ‚¬μ²΄λ“¤μ ZμΆν‘ μµλ“κ°’ - μµμ†κ°’(`z_range`) κ³„μ‚°.
    *   `seaborn.histplot`μΌλ΅ μ „μ²΄ μ„Έν¬μ Z-range λ¶„ν¬λ¥Ό κ·Έλ¦Ό.
*   **ν•΄μ„**: 3D μƒμ—μ„ μ„Έν¬ λ‘κ»λ‚ μ¤‘μ²© κ°€λ¥μ„± ν™•μΈ. (Xeniumμ€ μ£Όλ΅ 2D λ¶„μ„μ΄μ§€λ§ Z μ •λ³΄λ¥Ό λ³΄μ΅°μ μΌλ΅ ν™μ©).

### 2.3 μ „μ‚¬μ²΄ λ°€λ„ λ§µ (`step2_ssam/transcript_density_map.png`)
*   **κµ¬μ„±**: 2D ννΈλ§µ (X, Y μΆν‘). μƒ‰μƒμ€ μ „μ‚¬μ²΄ λ°€λ„.
*   **μƒμ„± μ›λ¦¬**:
    *   μ„Έν¬ κ²½κ³„(Segmentation)λ¥Ό λ¬΄μ‹ν•κ³ , λ¨λ“  μ „μ‚¬μ²΄ μΆν‘λ¥Ό 2D νμ¤ν† κ·Έλ¨(`plt.hist2d`) λλ” KDEλ΅ λ°€λ„ κ³„μ‚°.
    *   κ²©μ(Grid) λ‹¨μ„λ΅ μ „μ‚¬μ²΄ κ°μλ¥Ό μΉ΄μ΄νΈν•μ—¬ μ‹κ°ν™”.
*   **ν•΄μ„**: μ„Έν¬ κ²½κ³„ μ—†μ΄ μμν• μ μ „μ λ°ν„μ λ°€μ§‘ μ§€μ—­(Hotspot) ν™•μΈ. SSAM λ¶„μ„μ κΈ°μ΄ μ‹κ°ν™”.

---

## π“‚ Step 4 & 6: μµμ ν™” λ° μ‹λ®¬λ μ΄μ…

### 4.1 μµμ  ν™•μ¥ κ³΅μ„  (`_step4_optimization_curve.png`)
*   **κµ¬μ„±**: μ΄μ¤‘ Yμ¶• κ·Έλν”„.
    *   μ™Όμ½ μ¶•(νλ€μƒ‰): ν¬νλ μ „μ‚¬μ²΄ μ(Capture).
    *   μ¤λ¥Έμ½ μ¶•(λΉ¨κ°„μƒ‰): μλ„(Purity/Nuclear Fraction).
*   **μƒμ„± μ›λ¦¬**:
    *   μ„Έν¬ κ²½κ³„λ¥Ό 0Βµmμ—μ„ 15ΒµmκΉμ§€ 0.5Βµm λ‹¨μ„λ΅ κ°€μƒ ν™•μ¥ μ‹λ®¬λ μ΄μ….
    *   κ° κ±°λ¦¬λ§λ‹¤ ν¬ν•¨λλ” μ „μ‚¬μ²΄ μμ™€ ν•µ λ‚΄λ¶€ μ „μ‚¬μ²΄ λΉ„μ¨(μλ„ λ€μ©)μ„ κ³„μ‚°ν•μ—¬ `matplotlib`μΌλ΅ ν”λ΅ν….
*   **ν•΄μ„**: μλ„κ°€ κΈ‰κ²©ν λ–¨μ–΄μ§€κΈ° μ§μ „μ μµλ€ ν¬ν μ§€μ (Elbow point)μ„ μ°Ύμ•„ μµμ μ μ„Έν¬ ν™•μ¥ κ±°λ¦¬λ¥Ό κ²°μ •.

### 6.1 ARI ννΈλ§µ (`step6_simulation/simulation_ari_heatmap.png`)
*   **κµ¬μ„±**: 2D μ»¬λ¬ κ·Έλ¦¬λ“ (Xμ¶•: Quantile, Yμ¶•: Radius). κ° μΉΈμ μ«μλ” ARI μ μ.
*   **μƒμ„± μ›λ¦¬**:
    *   μλ°± κ°€μ§€ μ „μ²λ¦¬ νλΌλ―Έν„° μ΅°ν•©μΌλ΅ ν΄λ¬μ¤ν„°λ§ μν–‰ ν›„, Ground Truthμ™€ λΉ„κµν•μ—¬ ARI(μΌμΉλ„) μ μ μ‚°μ¶.
    *   κ²°κ³Ό λ°μ΄ν„°ν”„λ μ„μ„ ν”Όλ²—(Pivot)ν•μ—¬ ν–‰λ ¬λ΅ λ§λ“  λ’¤ `seaborn.heatmap`μΌλ΅ μ‹κ°ν™”.
*   **ν•΄μ„**: μ–΄λ–¤ νλΌλ―Έν„° μ΅°ν•©(λ°κ²½, λ¶„μ„μ λ“±)μ—μ„ ν΄λ¬μ¤ν„°λ§ μ„±λ¥μ΄ κ°€μ¥ μΆ‹μ€μ§€ μƒ‰μƒμΌλ΅ μ§κ΄€μ  νμ•….

---

## π“‚ Step 8: κ³µκ°„ λ³€μ μ μ „μ (SVF)

### 8.1 μƒμ„ SVG κ³µκ°„ λ§µ (`step8_svf/top_svgs_spatial.png`)
*   **κµ¬μ„±**: 9κ°μ μ‘μ€ μ΅°μ§ λ§µ (Subplots). κ° λ§µμ€ νΉμ • μ μ „μμ λ°ν„ κ°•λ„λ¥Ό μƒ‰μƒμΌλ΅ ν‘ν„.
*   **μƒμ„± μ›λ¦¬**:
    *   SpatialDE μ•κ³ λ¦¬μ¦μΌλ΅ κ³µκ°„μ  λ³€λ™μ„±(SV)μ΄ ν° μ μ „μ μμ„ μ„ μ •.
    *   μƒμ„ 9κ° μ μ „μμ— λ€ν•΄ `scanpy.pl.spatial(color=gene_name)`μ„ λ°λ³µ νΈμ¶ν•μ—¬ κ·Έλ¦¬λ“λ΅ λ°°μΉ.
*   **ν•΄μ„**: νΉμ • μ μ „μκ°€ μ΅°μ§μ μ–΄λ λ¶€μ„(μ: μ•” μ΅°μ§, κΈ°μ§ λ“±)μ— νΈν–¥λμ–΄ λ°ν„λλ”μ§€ μ‹κ°μ μΌλ΅ ν™•μΈ.
